@section styles
{

    <link rel="stylesheet" type="text/css" href="~/Content/angular-datatables.css" />
    <link rel="stylesheet" type="text/css" href="~/Content/angular-datepicker.css" />
    <link rel="stylesheet" type="text/css" href="~/Content/DataTables/dataTables.bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="~/Content/DataTables/responsive.bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="~/Content/mdr-file.min.css" />

    @*<link rel="stylesheet" type="text/css" href="~/Content/bootstrap.min.css" />*@


    <style type="text/css">
        .table-responsive {
            overflow-x: auto;
        }

        .preview-img {
            max-height: 270px;
        }

        #NewPatientModal .alert {
            padding: 5px;
            margin-bottom: 0px;
            margin-top: 5px;
        }

        .btn.active {
            background-color: #eeeeee;
        }

        a:hover {
            background: yellow;
        }

        .activeSb {
            background-color: #eeeeee;
        }

        input.ng-touched.ng-invalid {
            border-color: #f86c6b;
        }

        .input-hidden {
            position: absolute;
            left: -9999px;
        }

        .slider-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            /*border-radius: 50%;*/
            background: #4CAF50;
            cursor: pointer;
        }

        .slider-input {
            width: 100%;
            -webkit-appearance: none;
            height: 15px;
            /*border-radius: 5px;*/
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .slider-thumb {
            height: 2rem;
            width: 2rem;
            border-radius: 1rem;
            position: absolute;
            top: -0.75rem;
            background-color: #be1450;
            font-size: 100%;
            line-height: 2rem;
            text-align: center;
        }

        .dolor-cc {
            cursor: pointer;
            background-size: contain;
            background-repeat: no-repeat;
            display: inline-block;
            width: 100px;
            height: 70px;
            -webkit-transition: all 100ms ease-in;
            -moz-transition: all 100ms ease-in;
            transition: all 100ms ease-in;
            -webkit-filter: brightness(1.8) grayscale(1);
            -moz-filter: brightness(1.8) grayscale(1) opacity(.7);
            filter: brightness(1.8) grayscale(1) opacity(.7);
        }

        .cc-selector input:checked + .dolor-cc {
            -webkit-filter: none;
            -moz-filter: none;
            filter: none;
        }

        .cc-selector2 input:checked + .labelSelected {
            -webkit-filter: none;
            -moz-filter: none;
            filter: none;
            font-size: 20px;
            color: red;
        }

        .labelSelected {
            font-size: 12px;
            color: black;
        }

        .invalid-group {
            color: #f86c6b;
        }

        .tab-pane {
            padding-top: 20px;
        }

        .form-control-danger {
            background-color: #d9534f !important;
            color: white;
        }

        .searchButton {
            margin-bottom: 5px;
        }

        .form-control-success {
            background-color: #5cb85c !important;
            color: white;
        }

        .anchorColumn {
            width: 10%;
        }

        .ticks {
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
        }

        .tick {
            position: relative;
            display: flex;
            justify-content: center;
            width: 1px;
            background: gray;
            height: 10px;
            line-height: 50px;
            margin-bottom: 20px;
        }

        .activeSelect {
            border-radius: 3px;
            color: #17202A;
        }
    </style>
}
@section scripts
{
    <script type="text/javascript" src="~/Scripts/customUtil.js"></script>
    <script type="text/javascript" src="~/Scripts/angular-datepicker/angular-datepicker.js"></script>
    <script type="text/javascript" src="~/Scripts/DataTables/jquery.dataTables.js"></script>
    <script type="text/javascript" src="~/Scripts/angular-datatables.js"></script>
    <script type="text/javascript" src="~/Scripts/DataTables/dataTables.bootstrap.js"></script>
    <script type="text/javascript" src="~/Scripts/DataTables/dataTables.responsive.js"></script>
    <script type="text/javascript" src="~/Scripts/i18n/angular-locale_es-mx.js"></script>
    <script type="text/javascript" src="~/Scripts/moment-with-locales.js"></script>
    <script type="text/javascript" src="~/Scripts/DataTables/responsive.bootstrap.js"></script>
    <script type="text/javascript" src="~/Scripts/ng-file/ng-file-upload-shim.js"></script>
    <script type="text/javascript" src="~/Scripts/ng-file/ng-file-upload.js"></script>
    <script type="text/javascript" src="~/Scripts/mdr-angular-file-master/dist/mdr-file.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9.7.1/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill"></script>
    <script type="text/javascript">

        var INMEDIKApp = angular.module('INMEDIKApp', ["ui.bootstrap", "ui.bootstrap.tpls", 'datePicker', 'datatables', 'mdr.file', "ngFileUpload"]);
        INMEDIKApp.controller('ElectronicFileController', function ($scope, $compile, $sce, $http, $timeout, DTOptionsBuilder, DTColumnBuilder, Upload) {

            var dt = this;
            dt.saving = false;
            dt.vitalSigns = true;
            dt.EvNoteIndex = 0;
            dt.index = 0;
            dt.Evid = 0;
            dt.Refid = 0;
            dt.Inid = 0;
            dt.DetailObj = {};
            dt.dtInstance = {};
            dt.ConsultFile = {
                "identificationAux": null,
                "diseaseAux": null,
                "patientAux": null,
                "explorationAux": {
                    "painScale": 0,
                    "painScaleAdult": 0
                },
                "evolutionNotesAux": null,
                "interconsultAux": null,
                "servicenoteAux": null,
                "examnoteAux": null,
                "medicnoteAux": null,
                "referencenoteAux": null
            };
            dt.evolution = [];
            dt.categories = {};
            dt.CourseThreatment = [];
            dt.Plan = [];
            dt.Recipe = [];
            dt.medicamStock = {};
            dt.Auxindication = [];
            dt.DiseasesNote = [];
            dt.Recipe.Indications = [];
            dt.EvolutionNote = [];
            dt.DataDeletedEvolutionNote = [];
            dt.InterConsult = [];
            dt.ReferenceConsult = [];
            dt.examnoteAux = [];
            dt.PreviousResult = [];
            dt.medicamentstock = [];
            dt.Threatment = {};
            dt.Diagnostic = {};
            dt.RecipeAdd = false;
            dt.ClinicSquare = {};
            dt.ClinicProblems = {};
            dt.dtInstanceCIE10 = {};
            dt.errors = [];
            dt.ActiveCIE10 = "";
            dt.PatientData = {};
            dt.openSearchPatient = false;
            dt.idxImg = 0;
            dt.instock = "";
            dt.Updates = [];
            dt.LatestUpdates = [];
            dt.aheads = [];

            dt.selectedconcept = [];
            dt.conceptselected = [];

            dt.Prueba = {};

            dt.File = [{}];

            dt.DiagnosticIdx = 0;

            dt.PainScale = 0;
            dt.previewFile = previewFile;
            dt.regularExpretions = Ut_getRegularExpretions();
            dt.FormTouchedAndInvalid = false;

            //Viewbags
            dt.Diseases = JSON.parse('@Html.Raw(ViewBag.DiseaseRes)');
            dt.Nationalities = JSON.parse('@Html.Raw(ViewBag.NationalityRes)');
            dt.Specialities = JSON.parse('@Html.Raw(ViewBag.SpecialityRes)');
            dt.Clinics = JSON.parse('@Html.Raw(ViewBag.ClinicRes)');

            dt.NationalitiesL = [];
            $.each(dt.Nationalities, function () {
                dt.NationalitiesL.push({ id: this.id, name: this.name });
            });

            dt.SpecialitiesL = [];
            $.each(dt.Specialities, function () {
                dt.SpecialitiesL.push({ id: this.id, name: this.Name });
            });

            dt.ClinicsL = [];
            $.each(dt.Clinics, function () {
                dt.ClinicsL.push({ id: this.id, name: this.name });
            });
            //Fin de viewbags

            dt.sendIdx = function (idx) {
                dt.idxImg = idx;
            }

            function createdRow(row, data, dataIndex) {
                $compile(angular.element(row).contents())($scope);
            }

            function createdRowCIE10(row, data, dataIndex) {
                $compile(angular.element(row).contents())($scope);
            }

            function editBtn(data, type, full, meta) {
                return '<div class="text-center"><button type="button" ng-click="INMEDIKApp.LoadElement(' + data + ')" class="btn btn-info btn-xs"><i class="fa fa-pencil" aria-hidden="true"></i></button></div>';
            }

            dt.NewElement = function () {
                $("#PatientModal").modal('show');
                dt.PatientData = {};
                dt.namePatient = "";
            }

            dt.GetTouched = function ($event) {
                dt.FormTouchedAndInvalid = false;
                var elem = $event.target;
                $("#PatientForms input").each(function () {
                    if ($(this).hasClass("ng-invalid") && ($(this).hasClass("ng-touched") || this == elem)) {
                        dt.FormTouchedAndInvalid = true;
                        return false;
                    }
                });
                if (dt.FormTouchedAndInvalid) {
                    return;
                }
                $("#PatientForms select").each(function () {
                    if ($(this).hasClass("ng-invalid") && ($(this).hasClass("ng-touched") || this == elem)) {
                        dt.FormTouchedAndInvalid = true;
                        return false;
                    }
                });
                if (dt.FormTouchedAndInvalid) {
                    return;
                }
                $("#PatientForms textarea").each(function () {
                    if ($(this).hasClass("ng-invalid") && ($(this).hasClass("ng-touched") || this == elem)) {
                        dt.FormTouchedAndInvalid = true;
                        return false;
                    }
                });
                if (dt.FormTouchedAndInvalid) {
                    return;
                }
            };

            dt.loadClients = function (val) {
                return $http.post('@Url.Action("GetPatientsListFile", "Patient")', {
                    data: val
                }).then(function (response) {
                    return response.data.data.map(function (item) {
                        return item;
                    })
                });
            };

           dt.loadcategories = function (val) {
                return $http.post('@Url.Action("GetCategories", "Category")', {
                    data: val
                }).then(function (response) {
                    dt.categories = response.data.data;
                });
            };

            dt.validateatention = function (index) {
                if (index == "Servicios") {
                    if (dt.ConsultFile.servicenoteAux == undefined) {
                        dt.ConsultFile.servicenoteAux = []
                    }
                    dt.ConsultFile.servicenoteAux.unshift({
                        diagnosticAux: [],
                        filesAux: []
                    });
                }
                if (index == "Medicamentos") {
                    if (dt.ConsultFile.medicnoteAux == undefined) {
                        dt.ConsultFile.medicnoteAux = []
                    }
                    dt.ConsultFile.medicnoteAux.unshift({
                        diagnosticAux: [],
                        medicamstock: [],
                        recipeAux:[]
                    });
                }
            };

            dt.setPatientData = function (item) {
                dt.ConsultFile = {
                    identificationAux: {},
                    diseaseAux: {},
                    patientAux: {},
                    explorationAux: {
                        painScale: 0,
                        painScaleAdult: 0
                    },
                    evolutionNotesAux: [],
                    interconsultAux: [],
                    referencenoteAux: []
                };
                dt.PatientData = {};
                dt.PatientData = item;
                dt.ConsultFile.diseaseAux = dt.Diseases;
            }

            dt.SelectPatient = function (PatientData) {
                //dt.SelectandSave();
                dt.loadcategories();
                dt.ConsultFile.patientAux = PatientData;
                dt.ConsultFile.patientAux.ahfaux.commentsAux = [];
                dt.ConsultFile.identificationAux = PatientData.identificationAux;
                if (dt.ConsultFile.patientAux.ahfaux.familyAux.length < 1) {
                    dt.ConsultFile.patientAux.ahfaux.familyAux.push({
                        grandfather: true,
                        diseaseAux: []
                    });
                    dt.ConsultFile.patientAux.ahfaux.familyAux.push({
                        grandmother: true,
                        diseaseAux: []
                    });
                    dt.ConsultFile.patientAux.ahfaux.familyAux.push({
                        father: true,
                        diseaseAux: []
                    });
                    dt.ConsultFile.patientAux.ahfaux.familyAux.push({
                        mother: true,
                        diseaseAux: []
                    });
                    dt.ConsultFile.patientAux.ahfaux.familyAux.push({
                        brothers: true,
                        diseaseAux: []
                    });
                    dt.ConsultFile.patientAux.ahfaux.familyAux.push({
                        uncles: true,
                        diseaseAux: []
                    });
                }
                dt.dtInstance.reloadData();
                $("#PatientModal").modal('hide');
                dt.ConsultFile.evolutionNotesAux
                $('#History-nav').click();
                $("#ElectronicFileModal").modal('show');
            }

            dt.LoadElement = function (consultId) {
                mostrarPantallaCarga()
                dt.Plan = [];
                dt.Recipe = [];
                dt.EvolutionNote = [];
                dt.InterConsult = [];
                dt.ReferenceConsult = [];
                dt.PreviousResult = [];
                $http({
                    method: 'POST',
                    url: '@Url.Action("GetConsultFile","ElectronicFile")',
                    params: {
                        consultId: consultId
                    },
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    if (res.data.success) {
                        dt.ConsultFile = res.data.data;
                        dt.DetailObj = res.data.data;

                        if (dt.ConsultFile.patientAux.ahfaux.familyAux.length < 1) {
                            dt.ConsultFile.patientAux.ahfaux.familyAux.push({
                                grandfather: true,
                                diseaseAux: []
                            });
                            dt.ConsultFile.patientAux.ahfaux.familyAux.push({
                                grandmother: true,
                                diseaseAux: []
                            });
                            dt.ConsultFile.patientAux.ahfaux.familyAux.push({
                                father: true,
                                diseaseAux: []
                            });
                            dt.ConsultFile.patientAux.ahfaux.familyAux.push({
                                mother: true,
                                diseaseAux: []
                            });
                            dt.ConsultFile.patientAux.ahfaux.familyAux.push({
                                brothers: true,
                                diseaseAux: []
                            });
                            dt.ConsultFile.patientAux.ahfaux.familyAux.push({
                                uncles: true,
                                diseaseAux: []
                            });
                        }
                        if (dt.ConsultFile.currentConditionAux.coursethreatmentAux.length > 0) {
                            for (var i = 0; i < dt.ConsultFile.currentConditionAux.coursethreatmentAux.length; i++) {
                                dt.Plan.push({
                                    consecutivo: dt.ConsultFile.currentConditionAux.coursethreatmentAux[i].cie10Aux.consecutivo,
                                    catalog_key: dt.ConsultFile.currentConditionAux.coursethreatmentAux[i].catalog_key,
                                    nombre: dt.ConsultFile.currentConditionAux.coursethreatmentAux[i].cie10Aux.nombre,
                                    descripcion_capitulo: dt.ConsultFile.currentConditionAux.coursethreatmentAux[i].descripcion_capitulo,
                                    dose: dt.ConsultFile.currentConditionAux.coursethreatmentAux[i].dose,
                                    generalIndication: dt.ConsultFile.currentConditionAux.coursethreatmentAux[i].generalIndication,
                                    medicine: dt.ConsultFile.currentConditionAux.coursethreatmentAux[i].medicine,
                                    id: dt.ConsultFile.currentConditionAux.coursethreatmentAux[i].id
                                })
                            }
                        }
                        if (dt.ConsultFile.diagnosticAux.length > 0) {
                            for (var i = 0; i < dt.ConsultFile.diagnosticAux.length; i++) {
                                dt.Recipe.push({
                                    activeSubstance: dt.ConsultFile.diagnosticAux[i].activeSubstance,
                                    catalog_key: dt.ConsultFile.diagnosticAux[i].cie10Aux.catalog_key,
                                    commercialBrand: dt.ConsultFile.diagnosticAux[i].commercialBrand,
                                    consecutivo: dt.ConsultFile.diagnosticAux[i].cie10Aux.consecutivo,
                                    daysOfThreatment: dt.ConsultFile.diagnosticAux[i].daysOfThreatment,
                                    descripcion_capitulo: dt.ConsultFile.diagnosticAux[i].cie10Aux.descripcion_capitulo,
                                    dose: dt.ConsultFile.diagnosticAux[i].dose,
                                    frequency: dt.ConsultFile.diagnosticAux[i].frequency,
                                    nombre: dt.ConsultFile.diagnosticAux[i].cie10Aux.nombre,
                                    presentation: dt.ConsultFile.diagnosticAux[i].presentation,
                                    pronostic: dt.ConsultFile.diagnosticAux[i].pronostic,
                                    unit: dt.ConsultFile.diagnosticAux[i].unit,

                                    wayOfAdministration: dt.ConsultFile.diagnosticAux[i].wayOfAdministration,
                                })
                            }
                        }
                        if (dt.ConsultFile.previousResultAux.length > 0) {
                            for (var i = 0; i < dt.ConsultFile.previousResultAux.length; i++) {
                                dt.PreviousResult.push({
                                    id: dt.ConsultFile.previousResultAux[i].id,
                                    cholesterol: dt.ConsultFile.previousResultAux[i].cholesterol,
                                    dateOfTaking_Cholesterol: dt.ConsultFile.previousResultAux[i].dateOfTaking_Cholesterol,
                                    triglycerides: dt.ConsultFile.previousResultAux[i].triglycerides,
                                    dateOfTaking_Triglycerides: dt.ConsultFile.previousResultAux[i].dateOfTaking_Triglycerides,
                                    glucose: dt.ConsultFile.previousResultAux[i].glucose,
                                    dateOfTaking_Glucose: dt.ConsultFile.previousResultAux[i].dateOfTaking_Glucose,
                                    glucose_category: dt.ConsultFile.previousResultAux[i].glucose_category,
                                    comments: dt.ConsultFile.previousResultAux[i].comments,
                                    sCreated: dt.ConsultFile.previousResultAux[i].sCreated,
                                    CreatedBy: dt.ConsultFile.previousResultAux[i].CreatedBy,
                                })
                            }
                        }
                        if (dt.ConsultFile.evolutionNotesAux.length > 0) {
                            for (var i = 0; i < dt.ConsultFile.evolutionNotesAux.length; i++) {
                                dt.Recipe.push({
                                        recipe: dt.ConsultFile.evolutionNotesAux[i].recipeAux.recipe,
                                })
                            }
                        }
                        if (dt.ConsultFile.medicnoteAux.length > 0) {
                            dt.saving = true;
                        }


                    }
                    else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        quitarPantallaCarga()
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        quitarPantallaCarga()
                        $("#resultModal").modal('show');
                    }
                    dt.loadcategories();
                    dt.GetElectronicFileUpdates();

                }, function errorCallback(res) {
                    console.log("error: " + res);
                    }).finally(function () {
                       // $('#History-nav').click();
                    quitarPantallaCarga();
                    $("#ElectronicFileModal").modal('show');
                });
            }

            dt.ShowPdfPrenscription = function (index) {
                if (index.objRecipe) {
                    dt.recipe = index.objRecipe.id;
                } else {
                    dt.recipe = index.recipeAux.id;
                }
                window.open('@Url.Action("BuildPrenscription", "Schedule")/' + '?consultId=' + dt.DetailObj.id + '&' + 'noteid=' + dt.recipe);
            }

            $(document).on('hidden.bs.modal', function (e) {
            });


            $("#Evolutionnote-nav").on("click", function () {
                if (!dt.ConsultFile.evolutionNotesAux.length > 0) {
                    dt.addEvolutionNote();
                }

            });


            dt.addEvolutionNote = function () {
                dt.ConsultFile.evolutionNotesAux.unshift({
                    evolutionPreviousAux: [],
                    filesAux: [],
                    evolutionDiagnosticAux: [],
                    recipeAux: [],
                    medicamstock: []
                });
            }

            dt.addmedicstock = function (evolution) {
                dt.saving = true;
                evolution.medicamstock.unshift({});
            }

            dt.addMedicamDiagnosis = function (medicam) {
                medicam.diagnosticAux.unshift({});
            }
            dt.addDiagnosticServ = function (services) {
                services.diagnosticAux.unshift({});
            }
            dt.addDiagnosis = function (evolution) {
                evolution.evolutionDiagnosticAux.unshift({});
            }

            dt.addInterConsult = function (isTab) {
                if (isTab && dt.ConsultFile.interconsultAux.length == 0) {
                    dt.ConsultFile.interconsultAux.unshift({});
                } else if (!isTab) {
                    dt.ConsultFile.interconsultAux.unshift({});
                }  
            }

            dt.addReferenceConsult = function (isTab) {

                if (isTab && dt.ConsultFile.referencenoteAux.length == 0) {
                    dt.ConsultFile.referencenoteAux.unshift({});
                } else if (!isTab) {
                    dt.ConsultFile.referencenoteAux.unshift({});
                }               
            }

            dt.addExam = function () {
                dt.ConsultFile.examnoteAux.unshift({});
            }

            dt.addPreviousResult = function () {
                dt.PreviousResult.unshift({});
            }

            dt.addEvolPreviousResult = function (evolution) {
                evolution.evolutionPreviousAux.unshift({});
            }

            dt.medicstock = function (medicam) {
                dt.saving = true;
                medicam.medicamstock.unshift({});
            }

            dt.SelectMedicament = function (medicamselect, medicam) {
                medicam.medicamstock[0].stock = medicamselect.inStock;
            }

            dt.loadConcepts = function (val, cat) {
                return $http.post('@Url.Action("GetConceptsOfCategory", "Concept")', {
                    data: JSON.stringify({ typed: val, CategoryName: cat })
                }).then(function (response) {
                    dt.selectedconcept = response.data.data;
                    return response.data.data.map(function (item) {
                        return item;
                    })
                });
            };

            dt.SaveVitalSignsNote = function (concept, evolution, idx, electronicFileId, toPrint, tipec) {
                dt.DiseasesNote = evolution.evolutionDiagnosticAux;
                dt.setEvolDate(evolution);
                $http({
                    method: 'POST',
                    url: '@Url.Action("SaveCurrentNote", "ElectronicFile")',
                    data: {
                        concept: tipec,
                        evolution: evolution,
                        idx: idx,
                        electronicFileId: electronicFileId,
                        toPrint: toPrint
                    },
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    if (res.data.success) {
                        Swal.fire({
                            icon: 'success',
                            width: 600,
                            title: 'se han guardado los signos vitales, puede continuar.',
                            showConfirmButton: false,
                            timer: 1500
                        })
                    }
                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                });
            }

            dt.SaveCurrentNote = function (concept, evolution, idx, electronicFileId, toPrint, tipec) {
                dt.subbmiting = true;
                dt.DiseasesNote = evolution.evolutionDiagnosticAux;
                dt.setEvolDate(evolution);
                $http({
                    method: 'POST',
                    url: '@Url.Action("SaveCurrentNote", "ElectronicFile")',
                    data: {
                        concept: tipec,
                        evolution: evolution,
                        idx: idx,
                        electronicFileId: electronicFileId,
                        toPrint: toPrint
                    },
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    if (res.data.success) {
                        dt.vitalSigns = true;
                        dt.ConsultFile.evolutionNotesAux[res.data.data.currentIndex].id = res.data.data.id;
                        if (dt.ConsultFile.evolutionNotesAux[res.data.data.currentIndex].evolutionConditionAux != undefined) {
                            dt.ConsultFile.evolutionNotesAux[res.data.data.currentIndex].evolutionConditionAux.id = res.data.data.evolutionConditionAux.id;
                        }
                        if (dt.ConsultFile.evolutionNotesAux[res.data.data.currentIndex].evolutionExplorationAux != undefined) {
                            dt.ConsultFile.evolutionNotesAux[res.data.data.currentIndex].evolutionExplorationAux.id = res.data.data.evolutionExplorationAux.id;
                        }
                        if (dt.ConsultFile.evolutionNotesAux[res.data.data.currentIndex].evolutionDiagnosticAux != undefined) {
                            dt.ConsultFile.evolutionNotesAux[res.data.data.currentIndex].evolutionDiagnosticAux.id = res.data.data.evolutionDiagnosticAux.id;
                        }
                        if (evolution.id > 0) {
                            if (toPrint && res.data.data.objRecipe.id > 0) {
                                toPrint = false;
                                window.open('@Url.Action("BuildPrenscription", "Schedule")/' + '?consultId=' + dt.DetailObj.id + '&' + 'noteid=' + res.data.data.objRecipe.id);
                            }
                        }
                        else {
                            if (toPrint) {
                                toPrint = false;
                                window.open('@Url.Action("PrintRecipe", "ElectronicFile")?evolutionNoteId=' + res.data.data.id);
                            }
                        }
                        if (evolution.filesAux.length > 0) {
                            for (i = 0; i < evolution.filesAux.length; i++) {
                                if (evolution.filesAux[i].image != undefined) {
                                    evolution.filesAux[i].image.upload = Upload.upload({
                                        url: "@Url.Action("SaveImageEv", "Files")",
                                        data: { Description: evolution.filesAux[i].Description, File: evolution.filesAux[i].image, evId: res.data.data.id, fileId: evolution.filesAux[i].id },
                                    })

                                    evolution.filesAux[i].image.upload.then(function (res) {
                                        if (res.data.success) {
                                        }
                                        else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                                            dt.errors[0] = "La sesión ha caducado.";
                                            $("#resultModal").modal('show');
                                        }
                                        else {
                                            if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                                                dt.errors = res.data.errors;
                                            }
                                            else {
                                                dt.errors[0] = "Los datos del examen fueron guardados, pero ocurrio un eror al guardar los archivos";
                                                dt.errors[1] = res.data.message;
                                            }
                                            $("#resultModal").modal('show');
                                        }

                                    }, function (response) {
                                        if (response.status > 0)
                                            $scope.errorMsg = response.status + ': ' + response.data;

                                    }, function (evt) {
                                    });
                                }
                            }
                        }
                       // $("#ElectronicFileModal").modal('hide');
                    }
                    else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        $("#resultModal").modal('show');
                    }
                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                    dt.subbmiting = false;
                    dt.LoadElement(electronicFileId);
                });
            }

            dt.SaveCurrentInterconsult = function (interconsult, idx, electronicFileId) {
                dt.subbmiting = true;
                $http({
                    method: 'POST',
                    url: '@Url.Action("SaveCurrentInterconsult", "ElectronicFile")',
                    data: {
                        interconsult: interconsult,
                        idx: idx,
                        electronicFileId: electronicFileId,
                    },
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    if (res.data.success) {
                        dt.ConsultFile.interconsultAux.id = res.data.data.id;
                    }
                    else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        $("#resultModal").modal('show');
                    }
                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                    dt.subbmiting = false;
                    dt.LoadElement(electronicFileId);
                });
            }

            dt.SaveCurrentReferenceNote = function (reference, idx, electronicFileId) {
                dt.subbmiting = true;
                $http({
                    method: 'POST',
                    url: '@Url.Action("SaveCurrentReferenceNote", "ElectronicFile")',
                    data: {
                        reference: reference,
                        idx: idx,
                        electronicFileId: electronicFileId,
                    },
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    if (res.data.success) {
                        dt.ConsultFile.referencenoteAux.id = res.data.data.id;
                    }
                    else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        $("#resultModal").modal('show');
                    }
                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                    dt.subbmiting = false;
                    dt.LoadElement(electronicFileId);
                });
            }

            dt.ProductModal = function (idx, atention) {
                if (atention == undefined || 0) {
                    dt.index = idx;
                    //$("#PdDeletionWarningModal").modal('show');
                    Swal.fire({
                        title: '¿borrar datos?',
                        text: "Los datos no se han guardado!",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        cancelButtonText: 'cancelar',
                        confirmButtonText: 'continuar'
                    }).then((result) => {
                        if (result.value) {
                            $('#dltprodbtn').click();

                        }
                    })
                }
                else {
                    dt.Inid = interconsult.id;
                    $("#InCancellationWarningModal").modal('show');
                }
            }
            dt.ServiceModal = function (idx, service) {
                if (service == undefined || 0) {
                    dt.index = idx;
                    //$("#SvDeletionWarningModal").modal('show');
                    Swal.fire({
                        title: '¿borrar datos?',
                        text: "Los datos no se han guardado!",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        cancelButtonText: 'cancelar',
                        confirmButtonText: 'continuar'
                    }).then((result) => {
                        if (result.value) {
                            $('#dltservbtn').click();

                        }
                    })
                }
                else {
                    dt.Inid = interconsult.id;
                    $("#InCancellationWarningModal").modal('show');
                }
            }
            dt.MedicModal = function (idx, medicament) {
                if (medicament == undefined || 0) {
                    dt.index = idx;
                   //$("#MeDeletionWarningModal").modal('show');
                    Swal.fire({
                        title: '¿borrar datos?',
                        text: "Los datos no se han guardado!",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        cancelButtonText: 'cancelar',
                        confirmButtonText: 'continuar'
                    }).then((result) => {
                        if (result.value) {
                            $('#dltmedbtn').click();

                        }
                    })
                }
                else {
                    dt.Inid = interconsult.id;
                    $("#InCancellationWarningModal").modal('show');
                }
            }
            dt.ExamModal = function (idx, services) {
                if (services == undefined || 0) {
                    dt.index = idx;
                    //$("#SvDeletionWarningModal").modal('show');
                    Swal.fire({
                        title: '¿borrar datos?',
                        text: "Los datos no se han guardado!",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        cancelButtonText: 'cancelar',
                        confirmButtonText: 'continuar'
                    }).then((result) => {
                        if (result.value) {
                            $('#dltexmbtn').click();

                        }
                    })
                }
                else {
                    dt.Inid = interconsult.id;
                    $("#InCancellationWarningModal").modal('show');
                }
            }
            dt.EvolutionModal = function (idx, evolution) {
                if (evolution.id == undefined || 0) {
                    dt.index = idx;
                    $("#EvDeletionWarningModal").modal('show');
                }
                else {
                    dt.Evid = evolution.id;
                    $("#EvCancellationWarningModal").modal('show');
                }
            }

            dt.InterConsultModal = function (idx, interconsult) {
                if (interconsult.id == undefined || 0) {
                    dt.index = idx;
                    $("#InDeletionWarningModal").modal('show');
                }
                else {
                    dt.Inid = interconsult.id;
                    $("#InCancellationWarningModal").modal('show');
                }
            }

            dt.ReferenceModal = function (idx, reference) {
                if (reference.id == undefined || 0) {
                    dt.index = idx;
                    $("#RefDeletionWarningModal").modal('show');
                }
                else {
                    dt.Refid = reference.id;
                    $("#RefCancellationWarningModal").modal('show');
                }
            }

            dt.CancelEvolutionNote = function (Evid) {

                $http({
                    method: 'POST',
                    url: '@Url.Action("CancelEvolutionNote", "ElectronicFile")',
                    params: { EvId: Evid },
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    if (res.data.success) {
                        dt.ConsultFile.evolutionNotesAux.find(c => c.id == Evid).IsCancelled = true
                    }


                });
            }

            dt.CancelInterconsultNote = function (Inid) {
                $http({
                    method: 'POST',
                    url: '@Url.Action("CancelInterconsultNote", "ElectronicFile")',
                    params: { InId: Inid },

                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    if (res.data.success) {
                        dt.ConsultFile.interconsultAux.find(c => c.id == Inid).IsCancelled = true
                    }


                });
            }

            dt.CancelReferenceNote = function (Refid) {
                $http({
                    method: 'POST',
                    url: '@Url.Action("CancelReferenceNote", "ElectronicFile")',
                    params: { RefId: Refid },

                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    if (res.data.success) {
                        dt.ConsultFile.referencenoteAux.find(c => c.id == Refid).IsCancelled = true
                    }


                });
            }

            dt.change = function (mensaje) {
                console.log(mensaje);
            }

            dt.DeleteProductNote = function (idx) {
                dt.ConsultFile.productnoteAux.splice(idx, 1);
                $("#servselect").val('0')
            }
            dt.DeleteServiceNote = function (idx) {
                dt.ConsultFile.servicenoteAux.splice(idx, 1);
                $("#servselect").val('0')
            }
            dt.DeleteMedicamentNote = function (idx) {
                dt.ConsultFile.medicnoteAux.splice(idx, 1);
                $("#servselect").val('0')
            }
            dt.DeleteEvolutionNote = function (idx) {
                dt.ConsultFile.evolutionNotesAux.splice(idx, 1);
            }
            dt.DeleteExamNote = function (idx) {
                dt.ConsultFile.examnoteAux.splice(idx, 1)
            }

            dt.setDeleteMedic = function (index, item, medicam) {

                medicam.medicamstock.splice(index, item);
            }
            dt.DeleteInterConsult = function (idx) {
                //if (dt.ConsultFile.interconsultAux.length > 1) {
                dt.ConsultFile.interconsultAux.splice(idx, 1);
                //}
                //else {
                //    dt.ConsultFile = [{}];
                //}
            }

            dt.DeleteReferenceConsult = function (idx) {
                //if (dt.ReferenceConsult.length > 1) {
                dt.ConsultFile.referencenoteAux.splice(idx, 1);
                //}
                //else {
                //    dt.ReferenceConsult = [{}];
                //}
            }

            dt.DeletePreviousResult = function (idx) {
                //if (dt.PreviousResult.length > 1) {
                    dt.PreviousResult.splice(idx, 1);
                //}
                //else {
                //    dt.PreviousResult = [{}];
                //}
            }

            dt.DeleteEvolPreviousResult = function (evolution, idx) {
                if (evolution.evolutionPreviousAux.length > 1) {
                    evolution.evolutionPreviousAux.splice(idx, 1);
                }
                else {
                    evolution.evolutionPreviousAux = [{}];
                }
            }

            dt.DeleteDiagnosis = function (evolution, idx) {

                dt.RecipeAdd = false;

                if (evolution.evolutionDiagnosticAux) {
                    evolution.evolutionDiagnosticAux.splice(idx, 1);
                } else {
                    evolution.diagnosticAux.splice(idx, 1);
                }
            }

            dt.AddDisease = function (Threatment) {
                dt.Plan.push({
                    consecutivo: Threatment.consecutivo,
                    catalog_key: Threatment.catalog_key,
                    nombre: Threatment.nombre,
                    descripcion_capitulo: Threatment.descripcion_capitulo,
                    dose: Threatment.dose,
                    generalIndication: Threatment.generalIndication,
                    medicine: Threatment.medicine
                });
                dt.Threatment = {};
            }

            dt.AddToRecipe = function (evolutionNote, idx) {
                var alreadyIn = evolutionNote.recipeAux.filter(function (a) { return a.consecutivo == evolutionNote.evolutionDiagnosticAux[idx].consecutivo; })[0];
                if (evolutionNote.evolutionDiagnosticAux[idx].id != undefined) {
                    if (alreadyIn == undefined) {
                        evolutionNote.recipeAux.push({
                            consecutivo: evolutionNote.evolutionDiagnosticAux[idx].consecutivo,
                            nombre: evolutionNote.evolutionDiagnosticAux[idx].cie10Aux.nombre,
                            descripcion_capitulo: evolutionNote.evolutionDiagnosticAux[idx].descripcion_capitulo,
                            recipe: evolutionNote.recipeAux.recipe,
                            indicationsAux: [{
                                activeSubstance: evolutionNote.evolutionDiagnosticAux[idx].activeSubstance,
                                commercialBrand: evolutionNote.evolutionDiagnosticAux[idx].commercialBrand,
                                daysOfThreatment: evolutionNote.evolutionDiagnosticAux[idx].daysOfThreatment,
                                dose: evolutionNote.evolutionDiagnosticAux[idx].dose,
                                frequency: evolutionNote.evolutionDiagnosticAux[idx].frequency,
                                presentation: evolutionNote.evolutionDiagnosticAux[idx].presentation,
                                pronostic: evolutionNote.evolutionDiagnosticAux[idx].pronostic,
                                unit: evolutionNote.evolutionDiagnosticAux[idx].unit,
                                wayOfAdministration: evolutionNote.evolutionDiagnosticAux[idx].wayOfAdministration
                            }]
                        });
                    }
                    else {
                        var indice = evolutionNote.recipeAux.map(function (e) { return e.consecutivo; }).indexOf(evolutionNote.evolutionDiagnosticAux.consecutivo);

                        evolutionNote.recipeAux[indice].indicationsAux.push({
                            activeSubstance: evolutionNote.evolutionDiagnosticAux[idx].activeSubstance,
                            commercialBrand: evolutionNote.evolutionDiagnosticAux[idx].commercialBrand,
                            daysOfThreatment: evolutionNote.evolutionDiagnosticAux[idx].daysOfThreatment,
                            dose: evolutionNote.evolutionDiagnosticAux[idx].dose,
                            frequency: evolutionNote.evolutionDiagnosticAux[idx].frequency,
                            presentation: evolutionNote.evolutionDiagnosticAux[idx].presentation,
                            pronostic: evolutionNote.evolutionDiagnosticAux[idx].pronostic,
                            unit: evolutionNote.evolutionDiagnosticAux[idx].unit,
                            wayOfAdministration: evolutionNote.evolutionDiagnosticAux[idx].wayOfAdministration
                        });
                    }

                    dt.Auxindication = evolutionNote.recipeAux.indicationsAux;
                }
                else {
                    if (alreadyIn == undefined) {
                        evolutionNote.recipeAux.push({
                            consecutivo: evolutionNote.evolutionDiagnosticAux[idx].consecutivo,
                            nombre: evolutionNote.evolutionDiagnosticAux[idx].nombre,
                            descripcion_capitulo: evolutionNote.evolutionDiagnosticAux[idx].descripcion_capitulo,
                            recipe: evolutionNote.recipeAux.recipe,
                            indicationsAux: [{
                                activeSubstance: evolutionNote.evolutionDiagnosticAux[idx].activeSubstance,
                                commercialBrand: evolutionNote.evolutionDiagnosticAux[idx].commercialBrand,
                                daysOfThreatment: evolutionNote.evolutionDiagnosticAux[idx].daysOfThreatment,
                                dose: evolutionNote.evolutionDiagnosticAux[idx].dose,
                                frequency: evolutionNote.evolutionDiagnosticAux[idx].frequency,
                                presentation: evolutionNote.evolutionDiagnosticAux[idx].presentation,
                                pronostic: evolutionNote.evolutionDiagnosticAux[idx].pronostic,
                                unit: evolutionNote.evolutionDiagnosticAux[idx].unit,
                                wayOfAdministration: evolutionNote.evolutionDiagnosticAux[idx].wayOfAdministration

                            }]
                        });
                    }
                    else {
                        var indice = evolutionNote.recipeAux.map(function (e) { return e.consecutivo; }).indexOf(alreadyIn.consecutivo);

                        evolutionNote.recipeAux[indice].indicationsAux.push({
                            activeSubstance: evolutionNote.evolutionDiagnosticAux[idx].activeSubstance,
                            commercialBrand: evolutionNote.evolutionDiagnosticAux[idx].commercialBrand,
                            daysOfThreatment: evolutionNote.evolutionDiagnosticAux[idx].daysOfThreatment,
                            dose: evolutionNote.evolutionDiagnosticAux[idx].dose,
                            frequency: evolutionNote.evolutionDiagnosticAux[idx].frequency,
                            presentation: evolutionNote.evolutionDiagnosticAux[idx].presentation,
                            pronostic: evolutionNote.evolutionDiagnosticAux[idx].pronostic,
                            unit: evolutionNote.evolutionDiagnosticAux[idx].unit,
                            wayOfAdministration: evolutionNote.evolutionDiagnosticAux[idx].wayOfAdministration
                        });
                    }
                }
                dt.RecipeAdd = true;
                //dt.ConsultFile.evolutionNotesAux[dt.EvNoteIndex].evolutionDiagnosticAux[idx] = {
                //    consecutivo: evolutionNote.evolutionDiagnosticAux[idx].consecutivo,
                //    nombre: evolutionNote.evolutionDiagnosticAux[idx].nombre,
                //    descripcion_capitulo: evolutionNote.evolutionDiagnosticAux[idx].descripcion_capitulo
                //};
            };

            dt.RecipeRead = function () {
                $('#RecipeModal').modal('show');
            }
            dt.cleanPlan = function () {
                dt.Plan = [];
            }
            dt.cleanRecipe = function (evolution) {
               // dt.RecipeAdd = false;
               evolution.recipeAux = [];
                $('input[type="text"]').val('');
                console.log(dt.Auxindication);
            }

            dt.CleanOptions = function () {
                dt.ActiveCIE10 = "";
            }

            dt.loadPresentation = function (val) {
                return $http.post('@Url.Action("LoadPresentation", "ElectronicFile")', {
                    data: val
                }).then(function (response) {
                    return response.data.data.map(function (item) {
                        return item;
                    })
                });
            };

            dt.loadPharmaceuticalForm = function (val) {
                return $http.post('@Url.Action("GetUnit", "ElectronicFile")', {
                    data: val
                }).then(function (response) {
                    return response.data.data.map(function (item) {
                        return item;
                    })
                });
            };

            dt.loadActiveSubstance = function (val) {
                return $http.post('@Url.Action("LoadActiveSubstance", "ElectronicFile")', {
                    data: val
                }).then(function (response) {
                    return response.data.data.map(function (item) {
                        return item;
                    })
                });
            };

            dt.loadWayOfAdministration = function (val) {
                return $http.post('@Url.Action("GetWayOfAdministration", "ElectronicFile")', {
                    data: val
                }).then(function (response) {
                    return response.data.data.map(function (item) {
                        return item;
                    })
                });
            };

            dt.getPharmaceuticalForm = function (item, evolDiagnosis) {
                evolDiagnosis.unit = item.PharmaceuticalForm;
            }

            dt.getActiveSubstance = function (item, evolDiagnosis) {
                evolDiagnosis.activeSubstance = item.genericName;
            }

            dt.getPresentation = function (item, evolDiagnosis) {
                evolDiagnosis.presentation = item.presentation;
                console.log(evolDiagnosis.presentation);
            }

            dt.getWayOfAdministration = function (item, evolDiagnosis) {
                evolDiagnosis.wayOfAdministration = item.wayOfAdministration;
            }

            dt.slider_options = {
                showSelectionBar: true,
                showTicksValues: true,
                stepsArray: [
                    { value: 0, legend: 'Sin dolor' },
                    { value: 1 },
                    { value: 2 },
                    { value: 3 },
                    { value: 4 },
                    { value: 5 },
                    { value: 6 },
                    { value: 7 },
                    { value: 8 },
                    { value: 9 },
                    { value: 10, legend: 'El máximo dolor' }
                ],
                getSelectionBarColor: function (value) {
                    if (value <= 3)
                        return '#2AE02A';
                    if (value <= 6)
                        return 'yellow';
                    if (value <= 9)
                        return 'orange';
                    return 'red';
                }
            }

            dt.CalculateIMC = function (weight, size) {
                if (weight != null && size != null) {
                    dt.ConsultFile.explorationAux.imc = (weight / ((size / 100) * (size / 100))).toFixed(2);
                }
            }

            dt.CalculateIMCEvolution = function (weight, size, idx) {
                if (weight != null && size != null) {
                    dt.ConsultFile.evolutionNotesAux[idx].evolutionExplorationAux.imc = (weight / ((size / 100) * (size / 100))).toFixed(2);
                }
            }

            dt.PreSavePlan = function () {
                if (dt.Plan.length > 0) {
                    dt.ConsultFile.currentConditionAux.coursethreatmentAux = dt.Plan;
                }
                $http({
                    method: 'POST',
                    url: '@Url.Action("PreSavePlan", "ElectronicFile")',
                    data: dt.ConsultFile,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    if (res.data.success) {

                        window.open('@Url.Action("BuildPlan", "ElectronicFile")?consultFileId=' + dt.ConsultFile.consultId);

                    }
                    else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        $("#resultModal").modal('show');
                    }
                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                });
            }

            dt.PrintRecipe = function (idx, evolutionnote) {

                window.open('@Url.Action("PrintRecipe", "ElectronicFile")');
            }

            dt.PreSaveRecipe = function () {
                if (dt.Recipe.length > 0) {
                    dt.ConsultFile.diagnosticAux = dt.Recipe;
                }
                $http({
                    method: 'POST',
                    url: '@Url.Action("PreSaveRecipe", "ElectronicFile")',
                    data: dt.ConsultFile,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    if (res.data.success) {

                        window.open('@Url.Action("BuildRecipe", "ElectronicFile")?consultFileId=' + dt.ConsultFile.consultId);

                    }
                    else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        $("#resultModal").modal('show');
                    }
                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                    //$("#ConfirmSaveBranchRequestResponse").modal('hide');
                });
            }

            dt.showCIE10 = function (idx, type) {
                $("#CIE10Modal").modal('show');
                dt.DiagnosticIdx = idx;
            }

            dt.CleanText = function () {
                $('input[type="text"]').val('');
                $('input[type="number"]').val('');
                $('textarea[type="text"]').val('');
            };

            dt.setDate = function () {
                for (i = 0; i < dt.ConsultFile.previousResultAux.length; i++) {
                    if (dt.ConsultFile.previousResultAux[i].dateOfTaking_Cholesterol != null) {
                        dt.ConsultFile.previousResultAux[i].dateOfTaking_Cholesterol = moment(dt.ConsultFile.previousResultAux[i].dateOfTaking_Cholesterol).toDate();
                    }
                    if (dt.ConsultFile.previousResultAux[i].dateOfTaking_Triglycerides != null) {
                        dt.ConsultFile.previousResultAux[i].dateOfTaking_Triglycerides = moment(dt.ConsultFile.previousResultAux[i].dateOfTaking_Triglycerides).toDate();
                    }
                    if (dt.ConsultFile.previousResultAux[i].dateOfTaking_Glucose != null) {
                        dt.ConsultFile.previousResultAux[i].dateOfTaking_Glucose = moment(dt.ConsultFile.previousResultAux[i].dateOfTaking_Glucose).toDate();
                    }
                }
            }

            dt.setEvolDate = function (evolution) {
                if (evolution.evolutionPreviousAux != undefined) {
                for (i = 0; i < evolution.evolutionPreviousAux.length; i++) {
                    if (evolution.evolutionPreviousAux[i].dateOfTaking_Cholesterol != null) {
                        evolution.evolutionPreviousAux[i].dateOfTaking_Cholesterol = moment(evolution.evolutionPreviousAux[i].dateOfTaking_Cholesterol).toDate();
                    }
                    if (evolution.evolutionPreviousAux[i].dateOfTaking_Triglycerides != null) {
                        evolution.evolutionPreviousAux[i].dateOfTaking_Triglycerides = moment(evolution.evolutionPreviousAux[i].dateOfTaking_Triglycerides).toDate();
                    }
                    if (evolution.evolutionPreviousAux[i].dateOfTaking_Glucose != null) {
                        evolution.evolutionPreviousAux[i].dateOfTaking_Glucose = moment(evolution.evolutionPreviousAux[i].dateOfTaking_Glucose).toDate();
                    }
                    }
                }
            }

            //Crear paciente
            dt.createPatient = function () {
                dt.Patient = {
                    personAux: {}
                };
                dt.address = {};
                dt.person = {};
                dt.selectedState = undefined;
                dt.selectedCity = undefined;
                for (var i = 0; i < dt.NationalitiesL.length; i++) {
                    if (dt.NationalitiesL[i].name == "MEXICANA") {
                        var idx = i;
                    }
                }
                dt.person.nationalityAux = dt.NationalitiesL[idx];
                $("#NewPatientModal").modal("show");
            };
            $("#NewPatientModal").on("hidden.bs.modal", function () {
                dt.openSearchPatient = false;
                $scope.PatientForms.$setUntouched();
                dt.FormTouchedAndInvalid = false;
                dt.newPatient = {
                    personAux: {}
                };
            });

            $("#ElectronicFileModal").on("hidden.bs.modal", function () {
                dt.selectedconcept = [];
            });

            dt.setConceptSelected = function (item) {
                dt.selectedconcept = item;
                dt.conceptselected = item;

            }

            dt.SetPersonSelected = function (item) {
                /*-----------------------------------------------PERSON-----------------------------------------------*/
                dt.FillPerson(dt.PersonData[item]);
                /*-------------------------------------------END PERSON-----------------------------------------------*/
                /*-----------------------------------------------ADDRESSS-----------------------------------------------*/
                dt.FillAddress(dt.PersonData[item].addressAux);
                /*-------------------------------------------END ADDRESSS-----------------------------------------------*/
                dt.openSearchPatient = false;
            };

            /*-------------------------------------------PersonTable-----------------------------------------------*/
            dt.dtPersonOptions = DTOptionsBuilder.newOptions()
                .withOption("ajax", {
                    dataType: "json",
                    type: "POST",
                    url: "@Url.Action("GetPersons", "Patient")"
                })
                .withDataProp("data")
                .withPaginationType('full_numbers')
                .withOption('createdRow', createdRowPerson)
                .withOption('serverSide', true)
                .withOption('sDom', '<"top"l>rt<"bottom"ip><"clear">')
                .withLanguage({
                    "sEmptyTable": "No existen personas",
                    "sInfo": "Mostrando _START_ a _END_ de _TOTAL_ entradas",
                    "sInfoEmpty": "Mostrando de 0 a 0 de 0 entradas",
                    "sInfoFiltered": "(Filtrado de un todal de _MAX_ entradas)",
                    "sInfoPostFix": "",
                    "sInfoThousands": ",",
                    "sLengthMenu": "Mostrando _MENU_ entradas",
                    "sLoadingRecords": "Cargando...",
                    "sProcessing": "Procesando...",
                    "sSearch": "Buscar:",
                    "sZeroRecords": "No se encontraron personas",
                    "oPaginate": {
                        "sFirst": "Primero",
                        "sLast": "Ultimo",
                        "sNext": "Siguiente",
                        "sPrevious": "Anterior"
                    },
                    "oAria": {
                        "sSortAscending": ": ascendiente",
                        "sSortDescending": ": descendiente"
                    }
                });
            @* Definicion de las columnas del DT *@
            dt.dtPersonColumns = [
                DTColumnBuilder.newColumn("name").withTitle("Nombre"),
                DTColumnBuilder.newColumn("lastName").withTitle("Apellido Paterno"),
                DTColumnBuilder.newColumn("secondlastname").withTitle("Apellido Materno"),
                DTColumnBuilder.newColumn("sex").withTitle("Sexo"),
                DTColumnBuilder.newColumn("email").withTitle("Email"),
                DTColumnBuilder.newColumn("id").withTitle("Acción").renderWith(selectBtn).withClass('notSearchable').notSortable()
            ];
            function createdRowPerson(row, data, dataIndex) {
                $compile(angular.element(row).contents())($scope);
            }
            function selectBtn(data, type, full, meta) {
                if (dt.PersonData.indexOf(full) == -1) {
                    dt.PersonData.push(full);
                }
                return '<div class="text-center"><button type="button" ng-click="INMEDIKApp.SetPersonSelected(' + dt.PersonData.indexOf(full) + ')" class="btn btn-info btn-xs">Seleccionar</button></div>';
            }

            dt.PersonInstanceCallback = function (instance) {
                // Setup - add a text input to each footer cell
                dt.PersonData = [];
                dt.dtPersonInstance = instance;
                var id = '#' + dt.dtPersonInstance.id;
                $(id + ' thead th').each(function () {
                    var title = $(id + ' thead th').eq($(this).index()).text();
                    if (!$(this).hasClass('notSearchable')) {
                        $(this).html('<input type="text" class="form-control" placeholder="' + title + '" />');
                    }
                });

                var table = dt.dtPersonInstance.DataTable;
                // Apply the search
                table.columns().every(function () {
                    var that = this;

                    $('input', this.header()).on('keyup change', function (e) {
                        e.stopPropagation()
                        if (that.search() !== this.value) {
                            dt.PersonData = [];
                            that
                                .search(this.value)
                                .draw();
                        }
                    });
                    $('input', this.header()).on('click', function (e) {
                        e.stopPropagation()
                    });
                });
            };
            /*-------------------------------------------END PersonTable-----------------------------------------------*/

            dt.FillPerson = function (Person) {
                dt.person = Person;
                dt.person.birthDate = moment(Person.birthDate).toDate();
            }

            dt.FillAddress = function (Address) {
                dt.address = Address;
                dt.selectedCity = dt.address.countyAux.cityAux;
                dt.selectedState = dt.selectedCity.stateAux;
            }

            dt.ToggleSearch = function () {
                dt.openSearchPatient = !dt.openSearchPatient;
            }

            dt.SaveElementP = function () {
                dt.subbmiting = true;
                /*-----------------------------------------------PERSON-----------------------------------------------*/
                dt.Patient.personAux = dt.person;
                /*-------------------------------------------END PERSON-----------------------------------------------*/
                /*-----------------------------------------------ADDRESSS-----------------------------------------------*/
                dt.Patient.personAux.addressAux = dt.address;
                /*-------------------------------------------END ADDRESSS-----------------------------------------------*/
                dt.Patient.birthDate = moment(dt.Patient.birthDate).toDate();
                $http({
                    method: 'POST',
                    url: '@Url.Action("SavePatient", "Patient")',
                    data: dt.Patient,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {

                    if (res.data.success) {
                        //dt.setClientSelected(res.data.patient, true);
                        $("#NewPatientModal").modal('hide');
                    }
                    else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        $("#resultModal").modal('show');
                    }

                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                    dt.subbmiting = false;
                });
            };
            //termina creacion de paciente

            dt.SelectandSave = function () {
                dt.saving = true;
                if (dt.PreviousResult.length > 0) {
                    dt.ConsultFile.previousResultAux = dt.PreviousResult;
                    dt.setDate();
                }
                $http({
                    method: 'POST',
                    url: '@Url.Action("SaveClinicHistoryElements", "ElectronicFile")',
                    data: { ConsultFile: dt.ConsultFile },
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    dt.saving = false;

                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                });
            }

            dt.SaveClinicHistoryElements = function () {
                dt.saving = true;

                if (dt.PreviousResult.length > 0) {
                    dt.ConsultFile.previousResultAux = dt.PreviousResult;
                    dt.setDate();
                }
                $http({
                    method: 'POST',
                    url: '@Url.Action("SaveClinicHistoryElements", "ElectronicFile")',
                    data: { ConsultFile: dt.ConsultFile },
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    dt.saving = false;

                    if (res.data.success) {
                        dt.ConsultFile.id = res.data.data.id;
                        dt.ConsultFile.patientAux.ahfaux.id = res.data.data.patientAux.ahfaux.id;
                        dt.ConsultFile.patientAux.appAux.id = res.data.data.patientAux.appAux.id;
                        dt.ConsultFile.patientAux.apnpAux.id = res.data.data.patientAux.apnpAux.id;

                         Swal.fire({
                            icon: 'success',
                            width: 600,
                            title: 'se ha guardado correctamente',
                            showConfirmButton: false,
                            timer: 1500
                         })
                         dt.dtInstance.reloadData();
                    }
                    else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        $("#resultModal").modal('show');
                    }
                    $("#resultModal").modal('show');

                    dt.dtInstance.reloadData();


                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                });
            }

            dt.GetElectronicFileUpdates = function () {
                $http({
                    method: 'POST',
                    url: '@Url.Action("GetElectronicFileUpdates", "ElectronicFile")',
                    data: {ConsultFile: dt.ConsultFile},
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    if (res.data.success) {
                        var today = new Date();
                        dt.LatestUpdates.Update = [];
                        dt.LatestUpdates.UserUpdated = [];
                        dt.LatestUpdates.Source = [];
                        for (var c = 0; c < res.data.data.length; c++) {

                            if (res.data.data[c].Source == 'Nota de evolución') {
                                dt.LatestUpdates.Update.push('Pestaña Nota de Evolución por ' + res.data.data[c].UserUpdated + ' el ' + res.data.data[c].sUpdated);
                            }
                            else if (res.data.data[c].Source == 'Nota de interconsulta') {
                                dt.LatestUpdates.Update.push('Pestaña Nota de Interconsulta por ' + res.data.data[c].UserUpdated + ' el ' + res.data.data[c].sUpdated);
                            }
                            else if (res.data.data[c].Source == 'Nota de referencia') {
                                dt.LatestUpdates.Update.push('Pestaña Nota de Referencia por ' + res.data.data[c].UserUpdated + ' el ' + res.data.data[c].sUpdated);
                            }
                            else if (res.data.data[c].Source == 'Resultados previos de laboratorio') {
                                dt.LatestUpdates.Update.push('Pestaña Resultados previos de laboratorio por ' + res.data.data[c].UserUpdated + ' el ' + res.data.data[c].sUpdated);
                            }
                            else if (res.data.data[c].Source == 'Exploración física') {
                                dt.LatestUpdates.Update.push('Pestaña Exploración física por ' + res.data.data[c].UserUpdated + ' el ' + res.data.data[c].sUpdated);
                            }
                            else {
                                dt.LatestUpdates.Update.push('Pestaña Historia Clínica por ' + res.data.data[c].UserUpdated + ' el ' + res.data.data[c].sUpdated);
                            }

                        }
                    }
                    else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        $("#resultModal").modal('show');
                    }
                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                });
            }

            dt.SaveExplorationElements = function () {
                if (dt.PreviousResult.length > 0) {
                    dt.ConsultFile.previousResultAux = dt.PreviousResult;
                    dt.setDate();
                }
                $http({
                    method: 'POST',
                    url: '@Url.Action("SaveExplorationElements", "ElectronicFile")',
                    data: { ConsultFile: dt.ConsultFile },
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {

                    if (res.data.success) {
                        dt.ConsultFile.id = res.data.data.id;

                    }
                    else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        $("#resultModal").modal('show');
                    }
                    Swal.fire({
                        icon: 'success',
                        width: 600,
                        title: 'se ha guardado correctamente',
                        showConfirmButton: false,
                        timer: 1500
                    })
                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                });
            }

            dt.SaveServiceElements = function (services, idx, electronicFileId, toPrint) {

                $http({
                    method: 'POST',
                    url: '@Url.Action("SaveServices", "ElectronicFile")',
                    data: {
                        ConsultFile: dt.ConsultFile,
                        services: services,
                        //name: services.filesAux.image.name,
                        idx: idx,
                        electronicFileId: electronicFileId,
                        toPrint: toPrint
                    },
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                   
                    if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        $("#resultModal").modal('show');
                    }

                    $.each(dt.ConsultFile.servicenoteAux, function (i, service) {
                    var serviceId = service.id;

                    if (services.filesAux.length > 0) {
                        for (i = 0; i < services.filesAux.length; i++) {
                            if (services.filesAux[i].image != undefined) {
                                services.filesAux[i].image.upload = Upload.upload({
                                        url: "@Url.Action("SaveImageSv", "Files")",
                                    data: { Description: services.filesAux[i].Description, File: services.filesAux[i].image, evId: serviceId, fileId: services.filesAux[i].id },
                                    })

                                services.filesAux[i].image.upload.then(function (res) {
                                        if (res.data.success) {
                                        }
                                        else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                                            dt.errors[0] = "La sesión ha caducado.";
                                            $("#resultModal").modal('show');
                                        }
                                        else {
                                            if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                                                dt.errors = res.data.errors;
                                            }
                                            else {
                                                dt.errors[0] = "Los datos del examen fueron guardados, pero ocurrio un eror al guardar los archivos";
                                                dt.errors[1] = res.data.message;
                                            }
                                            $("#resultModal").modal('show');
                                        }

                                    }, function (response) {
                                        if (response.status > 0)
                                            $scope.errorMsg = response.status + ': ' + response.data;

                                    }, function (evt) {
                                    });
                                }
                            }
                        }
                    });
                        Swal.fire({
                            icon: 'success',
                            width: 600,
                            title: 'se ha guardado correctamente',
                            showConfirmButton: false,
                            timer: 1500
                        })
                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                    dt.subbmiting = false;
                    dt.LoadElement(electronicFileId);
                });
             }

            dt.SaveMedicamentElements = function (ConsultFile, medicaments, concepts) {
                console.log(medicaments);
                $http({
                    method: 'POST',
                    url: '@Url.Action("SaveMedicaments", "ElectronicFile")',
                    data: {
                        ConsultFile: dt.ConsultFile,
                        medicament: medicaments,
                    },
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {

                    if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        $("#resultModal").modal('show');
                    }
                    Swal.fire({
                        icon: 'success',
                        width: 600,
                        title: 'se ha guardado correctamente',
                        showConfirmButton: false,
                        timer: 1500
                    })
                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                });
             }


            dt.SaveExamnsElements = function () {
                if (dt.PreviousResult.length > 0) {
                    dt.ConsultFile.previousResultAux = dt.PreviousResult;
                    dt.setDate();
                }
                $http({
                    method: 'POST',
                    url: '@Url.Action("SaveExamns", "ElectronicFile")',
                    data: { ConsultFile: dt.ConsultFile },
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {

                    if (res.data.success) {
                        dt.ConsultFile.id = res.data.data.id;

                    }
                    else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        $("#resultModal").modal('show');
                    }
                    Swal.fire({
                        icon: 'success',
                        width: 600,
                        title: 'se ha guardado correctamente',
                        showConfirmButton: false,
                        timer: 1500
                    })
                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                });
            }

            dt.SavePreviousResult = function () {
                if (dt.PreviousResult.length > 0) {
                    dt.ConsultFile.previousResultAux = dt.PreviousResult;
                    dt.setDate();
                }
                $http({
                    method: 'POST',
                    url: '@Url.Action("SavePreviousResult", "ElectronicFile")',
                    data: { ConsultFile: dt.ConsultFile },
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {

                    if (res.data.success) {
                        dt.ConsultFile.id = res.data.data.id;

                    }
                    else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        $("#resultModal").modal('show');
                    }
                    Swal.fire({
                        icon: 'success',
                        width: 600,
                        title: 'se ha guardado correctamente',
                        showConfirmButton: false,
                        timer: 1500
                    })
                    $("#successModal").modal('show');
                }, function errorCallback(res) {
                    console.log("error: " + res);
                }).finally(function () {
                });
            }

            dt.RemoveFileModal = function (evolution, idx) {
                dt.index = idx;
                dt.evolution = evolution;
                $("#ImageDeleteModal").modal('show');
            }

            dt.RemoveFile = function (idx, evolution) {
                evolution.filesAux.splice(idx, 1);
            }

            dt.AddFileService = function (services) {
                services.filesAux.push({});
            }
            dt.AddFile = function (evolutionNote) {
                evolutionNote.filesAux.push({});
                console.log(evolutionNote);
            }


            dt.SaveFiles = function (evolution) {
                console.log(evolution);
            }


            dt.diseaseIsChkd = function (family, disease) {
                if (family.id == undefined && disease.id == 1) {
                    dt.saving = false;
                    family.diseaseAux[0] = { id: 1, name: "Interrogados y negados" };
                        return true;
                }
                else {
                    var disIdx = family.diseaseAux.findIndex(d => d.id == disease.id);
                     if (disIdx > -1) {
                     dt.saving = true;
                     return true;
                     }
                       {
                        return false;
                       }
                }

                dt.FamilyList = [];
                FamilyList.push(family);
            };
            dt.ValidateAHF = function (family, disease, diseaseIdx) {
                //expediente ya creado
                if (family.id != undefined && disease != undefined) {
                    var disIdx = family.diseaseAux.findIndex(d => d.id == disease.id);
                    if (disIdx > -1) {
                        family.diseaseAux.splice(disIdx, 1);
                        if (family.grandfather == true && family.diseaseAux.length == 0) {
                            $('#check0').prop('checked', true);
                            family.diseaseAux[0] = { id: 1, name: "Interrogados y negados" };
                        }
                        if (family.grandmother == true && family.diseaseAux.length == 0) {
                            $('#check1').prop('checked', true);
                            family.diseaseAux[0] = { id: 1, name: "Interrogados y negados" };
                        }
                        if (family.father == true && family.diseaseAux.length == 0) {
                            $('#check2').prop('checked', true);
                            family.diseaseAux[0] = { id: 1, name: "Interrogados y negados" };
                        }
                        if (family.mother == true && family.diseaseAux.length == 0) {
                            $('#check3').prop('checked', true);
                            family.diseaseAux[0] = { id: 1, name: "Interrogados y negados" };
                        }
                        if (family.brothers == true && family.diseaseAux.length == 0) {
                            $('#check4').prop('checked', true);
                            family.diseaseAux[0] = { id: 1, name: "Interrogados y negados" };
                        }
                        if (family.uncles == true && family.diseaseAux.length == 0) {
                            $('#check5').prop('checked', true);
                            family.diseaseAux[0] = { id: 1, name: "Interrogados y negados" };
                        }
                    }
                    else {
                        if (family.grandfather == true && family.diseaseAux.length > 0) {
                            $('#check0').prop('checked', false);
                        }
                        if (family.grandmother == true && family.diseaseAux.length > 0) {
                            $('#check1').prop('checked', false);
                        }
                        if (family.father == true && family.diseaseAux.length > 0) {
                            $('#check2').prop('checked', false);
                        }
                        if (family.mother == true && family.diseaseAux.length > 0) {
                            $('#check3').prop('checked', false);
                        }
                        if (family.brothers == true && family.diseaseAux.length > 0) {
                            $('#check4').prop('checked', false);
                        }
                        if (family.uncles == true && family.diseaseAux.length > 0) {
                            $('#check5').prop('checked', false);
                        }
                        const first = family.diseaseAux[0];
                        if (first.id == 1) {
                            family.diseaseAux.splice(0, 1, disease);
                        } else {
                            family.diseaseAux.push(disease);
                        }

                    }
                }
                //nuevo expediente
                else {
                    var disIdx = family.diseaseAux.findIndex(d => d.id == disease.id);
                    if (disIdx > -1) {
                        family.diseaseAux.splice(disIdx, 1);
                        if (family.grandfather == true && family.diseaseAux.length == 0) {
                            $('#check0').prop('checked', true);
                            family.diseaseAux[0] = { id: 1, name: "Interrogados y negados" };
                        }
                        if (family.grandmother == true && family.diseaseAux.length == 0) {
                            $('#check1').prop('checked', true);
                            family.diseaseAux[0] = { id: 1, name: "Interrogados y negados" };
                        }
                        if (family.father == true && family.diseaseAux.length == 0) {
                            $('#check2').prop('checked', true);
                            family.diseaseAux[0] = { id: 1, name: "Interrogados y negados" };
                        }
                        if (family.mother == true && family.diseaseAux.length == 0) {
                            $('#check3').prop('checked', true);
                            family.diseaseAux[0] = { id: 1, name: "Interrogados y negados" };
                        }
                        if (family.brothers == true && family.diseaseAux.length == 0) {
                            $('#check4').prop('checked', true);
                            family.diseaseAux[0] = { id: 1, name: "Interrogados y negados" };
                        }
                        if (family.uncles == true && family.diseaseAux.length == 0) {
                            $('#check5').prop('checked', true);
                            family.diseaseAux[0] = { id: 1, name: "Interrogados y negados" };
                        }
                    }
                    else {
                        if (family.grandfather == true && family.diseaseAux.length > 0) {
                            $('#check0').prop('checked', false);
                        }
                        if (family.grandmother == true && family.diseaseAux.length > 0) {
                            $('#check1').prop('checked', false);
                        }
                        if (family.father == true && family.diseaseAux.length > 0) {
                            $('#check2').prop('checked', false);
                        }
                        if (family.mother == true && family.diseaseAux.length > 0) {
                            $('#check3').prop('checked', false);
                        }
                        if (family.brothers == true && family.diseaseAux.length > 0) {
                            $('#check4').prop('checked', false);
                        }
                        if (family.uncles == true && family.diseaseAux.length > 0) {
                            $('#check5').prop('checked', false);
                        }
                        const first = family.diseaseAux[0];
                        if (first.id == 1) {
                            family.diseaseAux.splice(0, 1, disease);
                        } else {
                            family.diseaseAux.push(disease);
                        }

                    }
                }
            };

            dt.dtElectronicFileOptions = DTOptionsBuilder.newOptions()
            .withOption("ajax", {
                dataType: "json",
                type: "POST",
                url: "@Url.Action("GetElectronicFiles", "ElectronicFile")"
            })
                .withDataProp("data")
                .withPaginationType('full_numbers')
                .withOption('createdRow', createdRow)
                .withOption('serverSide', true)
                .withOption('sDom', '<"top"l>rt<"bottom"ip><"clear">')
                .withLanguage({
                    "sEmptyTable": "No existen expedientes",
                    "sInfo": "Mostrando _START_ a _END_ de _TOTAL_ entradas",
                    "sInfoEmpty": "Mostrando de 0 a 0 de 0 entradas",
                    "sInfoFiltered": "(Filtrado de un todal de _MAX_ entradas)",
                    "sInfoPostFix": "",
                    "sInfoThousands": ",",
                    "sLengthMenu": "Mostrando _MENU_ entradas",
                    "sLoadingRecords": "Cargando...",
                    "sProcessing": "Procesando...",
                    "sSearch": "Buscar:",
                    "sZeroRecords": "No se encontraron expedientes",
                    "oPaginate": {
                        "sFirst": "Primero",
                        "sLast": "Ultimo",
                        "sNext": "Siguiente",
                        "sPrevious": "Anterior"
                    },
                    "oAria": {
                        "sSortAscending": ": ascendiente",
                        "sSortDescending": ": descendiente"
                    }
                });

            @* Definicion de las columnas del DT *@
            dt.dtElectronicFileColumns = [
                DTColumnBuilder.newColumn("fileId").withTitle("Id Expediente"),
                DTColumnBuilder.newColumn("patientId").withTitle("Id Paciente"),
                DTColumnBuilder.newColumn("fullName").withTitle("Nombre"),
                DTColumnBuilder.newColumn("sex_string").withTitle("Sexo"),
                DTColumnBuilder.newColumn("fileId").withTitle("Ver").renderWith(editBtn).withClass('notSearchable').notSortable()
            ];

            dt.InstanceCallback = function (instance) {
                // Setup - add a text input to each footer cell
                dt.dtInstance = instance;
                var id = '#' + dt.dtInstance.id;
                $(id + ' thead th').each(function () {
                    var title = $(id + ' thead th').eq($(this).index()).text();
                    if (!$(this).hasClass('notSearchable')) {
                        $(this).html('<input type="text" class="form-control" placeholder="' + title + '" />');
                    }
                });

                var table = dt.dtInstance.DataTable;
                // Apply the search
                table.columns().every(function () {
                    var that = this;

                    $('input', this.header()).on('keyup change', function (e) {
                        e.stopPropagation()
                        if (that.search() !== this.value) {
                            that
                                .search(this.value)
                                .draw();
                        }
                    });
                    $('input', this.header()).on('click', function (e) {
                        e.stopPropagation()
                    });
                });
            };

            dt.dtOptionsCIE10 = DTOptionsBuilder.newOptions()
                 .withOption("ajax", {
                     dataType: "json",
                     type: "POST",
                     url: "@Url.Action("GetCIE10", "CIE10")"
                 })
                .withDataProp("data")
                .withPaginationType('full_numbers')
                .withOption('createdRow', createdRowCIE10)
                .withOption('serverSide', true)
                .withOption('infoCallback', function (settings) {
                    dt.CIE10 = [];
                    $.each(settings.aoData, function (idx, item) {
                        dt.CIE10.push(item._aData);
                    })
                })
                .withOption('responsive', true)
                .withOption('sDom', '<"top"l>rt<"bottom"ip><"clear">')
                .withLanguage({
                    "sEmptyTable": "No existen registros",
                    "sInfo": "Mostrando _START_ a _END_ de _TOTAL_ entradas",
                    "sInfoEmpty": "Mostrando de 0 a 0 de 0 entradas",
                    "sInfoFiltered": "(Filtrado de un todal de _MAX_ entradas)",
                    "sInfoPostFix": "",
                    "sInfoThousands": ",",
                    "sLengthMenu": "Mostrando _MENU_ entradas",
                    "sLoadingRecords": "Cargando...",
                    "sProcessing": "Procesando...",
                    "sSearch": "Buscar:",
                    "sZeroRecords": "No se encontraron registros",
                    "oPaginate": {
                        "sFirst": "Primero",
                        "sLast": "Ultimo",
                        "sNext": "Siguiente",
                        "sPrevious": "Anterior"
                    },
                    "oAria": {
                        "sSortAscending": ": ascendiente",
                        "sSortDescending": ": descendiente"
                    }
                });

            function AddCIE10DiseaseBtn(data, type, full, meta) {
                return '<div class="text-center"><button type="button" ng-click="INMEDIKApp.AddCIE10Disease(' + data + ', '+ type +')" class="btn btn-info btn-xs"><i class="fa fa-plus" aria-hidden="true"></i> Agregar</button></div>';
            }

            dt.ActiveCIE10Catalog = function (active, idx) {
                dt.ActiveCIE10 = active;
                dt.EvNoteIndex = idx;
            }

            dt.AddCIE10Disease = function (Consecutivo, type) {

                var elem = dt.CIE10.filter(function (a) { return a.consecutivo == Consecutivo; })[0];
                var alreadyIn = dt.Plan.filter(function (a) { return a.consecutivo == Consecutivo; })[0];

                if (elem != undefined && alreadyIn == undefined) {
                    if (dt.ConsultFile.evolutionNotesAux.length > 0)
                    {
                        dt.ConsultFile.evolutionNotesAux[dt.EvNoteIndex].evolutionDiagnosticAux[dt.DiagnosticIdx] = {
                            consecutivo: elem.consecutivo,
                            catalog_key: elem.catalog_Key,
                            name: elem.nombre,
                            descripcion_capitulo: elem.descripcion_capitulo
                        }
                    }
                    if (dt.ConsultFile.servicenoteAux.length > 0)
                    {
                        dt.ConsultFile.servicenoteAux[dt.EvNoteIndex].diagnosticAux[dt.DiagnosticIdx] = {
                            consecutivo: elem.consecutivo,
                            catalog_key: elem.catalog_Key,
                            name: elem.nombre,
                            descripcion_capitulo: elem.descripcion_capitulo
                        }
                    }
                    if (dt.ConsultFile.medicnoteAux.length > 0)
                    {
                        dt.ConsultFile.medicnoteAux[dt.EvNoteIndex].diagnosticAux[dt.DiagnosticIdx] = {
                            consecutivo: elem.consecutivo,
                            catalog_key: elem.catalog_Key,
                            name: elem.nombre,
                            descripcion_capitulo: elem.descripcion_capitulo
                        }
                    }

                    $("#CIE10Modal").modal('hide');
                   // $('#Evolucion-tab').click();
                   // $('#History-tab').addClass('active');
                }
            }

            dt.dtColumnsCIE10 = [
                DTColumnBuilder.newColumn("consecutivo").withTitle("Id"),
                DTColumnBuilder.newColumn("catalog_Key").withTitle("Clave"),
                DTColumnBuilder.newColumn("nombre").withTitle("Enfermedad"),
                DTColumnBuilder.newColumn("descripcion_capitulo").withTitle("Categoría"),
                DTColumnBuilder.newColumn("consecutivo").withTitle("Agregar").renderWith(AddCIE10DiseaseBtn).withClass('notSearchable').notSortable()
            ]

            dt.dtInstanceCallbackCIE10 = function (instance) {
                // Setup - add a text input to each footer cell
                dt.dtInstanceCIE10 = instance;
                var id = '#' + dt.dtInstanceCIE10.id;
                $(id + ' thead th').each(function () {
                    var title = $(id + ' thead th').eq($(this).index()).text();
                    if (!$(this).hasClass('notSearchable')) {
                        $(this).html('<input type="text" class="form-control" placeholder="' + title + '" />');
                    }
                });

                var table = dt.dtInstanceCIE10.DataTable;
                // Apply the search
                table.columns().every(function () {
                    var that = this;

                    $('input', this.header()).on('keyup change', function (e) {
                        e.stopPropagation()
                        if (that.search() !== this.value) {
                            that
                                .search(this.value)
                                .draw();
                        }
                    });
                    $('input', this.header()).on('click', function (e) {
                        e.stopPropagation()
                    });
                });
            };

            /*-----------------------------------------------CONFIG DATEPICKER-----------------------------------------------*/
            dt.datepickerOptions = {
                datepickerMode: 'year',
                showWeeks: 'false'
            };
            dt.datepickerFormat = 'dd/MM/yyyy';
            dt.dpOpen = false;
            dt.OpenDP = function () {
                dt.dpOpen = true;
            };
            /*-----------------------------------------------CONFIG DATEPICKER-----------------------------------------------*/

            dt.UpdateCities = function (callback) {
                $http({
                    method: 'POST',
                    url: '@Url.Action("GetCitiesSelect", "City")',
                    data: dt.selectedState,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    dt.cities = res.data.data;
                    //dt.selectedCity = undefined;
                    //dt.address.countyAux = undefined;
                    if (callback != undefined)
                        callback();

                }, function errorCallback(res) {
                    console.log("error: " + res);
                });

            };
            dt.UpdateCounties = function () {
                $http({
                    method: 'POST',
                    url: '@Url.Action("GetCountiesSelect", "County")',
                    data: dt.selectedCity,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    dt.counties = res.data.data;
                }, function errorCallback(res) {
                    console.log("error: " + res);
                });
            };

            function init() {
                $http({
                    method: 'POST',
                    url: '@Url.Action("GetStatesSelect", "State")',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }).then(function (res) {
                    if (res.data.success) {
                        dt.states = res.data.data;
                        dt.selectedState = undefined;

                    }
                    else if (res.data.success == undefined && res.data.indexOf("SignIn") > -1) {
                        dt.errors[0] = "La sesión ha caducado.";
                        $("#resultModal").modal('show');
                    }
                    else {
                        if (res.data.errors != undefined && res.data.errors && res.data.errors.length > 0) {
                            dt.errors = res.data.errors;
                        }
                        else {
                            dt.errors[0] = res.data.message;
                        }
                        $("#resultModal").modal('show');
                    }

                }, function errorCallback(res) {
                    console.log("error: " + res);
                });

                dt.UpdateCities();
                dt.UpdateCounties();
            };
            init();

        });
    </script>

    <script type="text/javascript">

        function previewFile(data) {


            var preview = $(data).siblings('img.preview-img')[0];
            var file = $(data)[0].files[0];

            var reader = new FileReader();

            reader.onloadend = function () {
                preview.src = reader.result;
            }

            if (file) {
                reader.readAsDataURL(file);
            } else {
                preview.src = "";
            }
        }
    </script>
}

<div class="container-fluid" ng-controller="ElectronicFileController as INMEDIKApp">
    <div class="panel panel-default">
        <div class="panel-heading">
            Expedientes <button class="btn btn-xs btn-success pull-right" ng-click="INMEDIKApp.NewElement()">Crear Nuevo</button>
        </div>
        <div class="panel-body">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table id="ElectronicFileTable" datatable dt-options="INMEDIKApp.dtElectronicFileOptions" dt-columns="INMEDIKApp.dtElectronicFileColumns" dt-instance="INMEDIKApp.InstanceCallback" class="table table-hover table-bordered"></table>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade modal-info" id="ElectronicFileModal" data-refresh="true" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
        <div class="modal-dialog modal-lg" style="width: 80%; margin: auto;">
            <div class="modal-content">
                <div class="modal-header col-md-12">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                    <h4 class="modal-title">Expediente</h4>
                </div>
                <div class="modal-body col-md-12">
                    <div class="col-md-12">
                        <h4 class="modal-title">Ficha de identificación: </h4>
                    </div>
                    <div class="form-group col-md-12">
                        <div class="col-md-4">
                            <label class="col-md-3">Fecha: </label>
                            <div class="col-md-9">
                                {{INMEDIKApp.ConsultFile.identificationAux.created_date}}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="col-md-3">Folio: </label>
                            <div class="col-md-9">
                                {{INMEDIKApp.ConsultFile.identificationAux.expFolio}}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="col-md-3">Médico: </label>
                            <div class="col-md-9">
                                {{INMEDIKApp.ConsultFile.identificationAux.medicName}}
                            </div>
                        </div>

                    </div>
                    <div class="form-group col-md-12">
                        <div class="col-md-4">
                            <label class="col-md-3">Paciente: </label>
                            <div class="col-md-9">
                                {{INMEDIKApp.ConsultFile.identificationAux.patientFullName}}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="col-md-3">Curp: </label>
                            <div class="col-md-3">
                                {{INMEDIKApp.ConsultFile.identificationAux.curp}}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="col-md-7">Fecha de nacimiento: </label>
                            <div class="col-md-4">
                                {{INMEDIKApp.ConsultFile.identificationAux.birthdate_string}}
                            </div>
                        </div>

                    </div>
                    <div class="form-group col-md-12">
                        <div class="col-md-4">
                            <label class="col-md-3">Sexo: </label>
                            <div class="col-md-9">
                                {{INMEDIKApp.ConsultFile.identificationAux.sex_string}}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="col-md-4">Empresa: </label>
                            <div class="col-md-8">
                                {{INMEDIKApp.ConsultFile.patientAux.personAux.companyName}}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="col-md-3">Edad: </label>
                            <div class="col-md-9">
                                {{INMEDIKApp.ConsultFile.identificationAux.age_string}}
                            </div>
                        </div>

                    </div>
                    <div class="form-group col-md-11">
                        <div class="col-md-4">
                            <label class="col-md-3">Clínica: </label>
                            <div class="col-md-9">
                                {{INMEDIKApp.ConsultFile.identificationAux.clinicName}}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <ul class="nav nav-tabs">
                            <li class="active in" id="clinicHistory">
                                <a id="History-nav" data-toggle="tab" href="#History-tab">Historia Clínica</a>
                            </li>
                            <li ng-class="{'disabled': (INMEDIKApp.ConsultFile.id == undefined)}" id="fisicExploration">
                                <a id="Physical-nav" ng-click="type = 'Fisica'" data-toggle="tab" href="#AS-tab">Exploración física</a>
                            </li>
                            <li ng-class="{'disabled': (INMEDIKApp.ConsultFile.id == undefined)}" id="consult">
                                <a id="Evolutionnote-nav" ng-click="type = 'Evolucion';INMEDIKApp.ActiveCIE10Catalog('Evolucion')" data-toggle="tab"
                                   href="#Evolucion-tab">Consultas</a>
                            </li>
                            <li ng-class="{'disabled': (INMEDIKApp.ConsultFile.id == undefined)}" id="atentions">
                                <a id="Serv-nav" data-toggle="tab" href="#Serv-tab">Atenciones</a>
                            </li>
                            <li ng-class="{'disabled': (INMEDIKApp.ConsultFile.id == undefined)}" id="exams">
                                <a id="Exam-nav" ng-click="type = 'Examenes'" data-toggle="tab" href="#Examn-tab">Exámenes</a>
                            </li>
                            <li ng-class="{'disabled': (INMEDIKApp.ConsultFile.id == undefined)}" id="interconsult">
                                <a id="Interconsultationnote-nav" ng-click="INMEDIKApp.addInterConsult(true)" data-toggle="tab"
                                   href="#Interconsulta-tab">Nota de interconsulta</a>
                            </li>
                            <li ng-class="{'disabled': (INMEDIKApp.ConsultFile.id == undefined)}" id="reference">
                                <a id="Referencenote-nav" ng-click="INMEDIKApp.addReferenceConsult(true)" data-toggle="tab"
                                   href="#Referencia-tab">Nota de referencia</a>  
                            </li>
                        </ul>
                        <div class="tab-content">
                            @* inicio historia clinica *@
                            <div id="History-tab" class="tab-pane fade in active">
                                <div class="form-horizontal">
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <div class="col-md-2">
                                                <ul class="nav nav-pills col-md-12">
                                                    <li class="active">
                                                        <a id="AH-nav" href="#AH-tab" data-toggle="tab" data-placement="right" data-container="body" title="Antecedentes Heredofamiliares">
                                                            Antecedentes Heredo Familiares
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a href="#APP-tab" data-toggle="tab" data-placement="right" data-container="body" title="Antecedentes Personales Patológicos">
                                                            Antecedentes Personales Patológicos
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a href="#APNP-tab" data-toggle="tab" data-placement="right" data-container="body" title="Antecedentes Personales No Patológicos">
                                                            Antecedentes Personales No Patológicos
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a href="#ModifiedBy-tab" data-toggle="tab" data-placement="right" data-container="body" title="Última Modificación del Expediente" ng-click="INMEDIKApp.GetElectronicFileUpdates()">
                                                            Última Modificación del Expediente
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="col-md-10">
                                                <div class="tab-content">
                                                    <div id="AH-tab" class="tab-pane fade in active">
                                                        <div class="form-horizontal">
                                                            <div class="form-group">
                                                                <div class="col-md-12 no-padding-sides">
                                                                    <table class="table table-bordered table-hover table-responsive">
                                                                        <thead>
                                                                            <tr class="col-md-12">
                                                                                <td class="col-md-3"></td>
                                                                                <td class="col-md-1">Abuelo</td>
                                                                                <td class="col-md-1">Abuela</td>
                                                                                <td class="col-md-1">Papá</td>
                                                                                <td class="col-md-1">Mamá</td>
                                                                                <td class="col-md-1">Hermanos</td>
                                                                                <td class="col-md-1">Tíos</td>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr class="col-md-12" ng-repeat="disease in INMEDIKApp.ConsultFile.diseaseAux" ng-init="INMEDIKApp.arr2d[$index] = [];">
                                                                                <td class="col-md-3">{{disease.name}}</td>
                                                                                <td class="col-md-1" ng-repeat="family in INMEDIKApp.ConsultFile.patientAux.ahfaux.familyAux" ng-init="INMEDIKApp.arr2d[$parent.$index][$index] = INMEDIKApp.diseaseIsChkd(family,disease);">
                                                                                    <input id="check{{$index}}" class="col-md-12" type="checkbox" 
                                                                                            ng-model="INMEDIKApp.arr2d[$parent.$index][$index]" @*ng-checked="INMEDIKApp.diseaseIsChkd(family,disease)" *@ 
                                                                                            ng-change="INMEDIKApp.ValidateAHF(family,disease,$parent.$index, $index)" 
                                                                                         ng-disabled="$parent.$index == 0" />
                                                                                </td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                                <div class="clearfix"></div>
                                                                <div class="form-group col-md-12">
                                                                    <label class="control-label col-md-2">Otros: </label>
                                                                    <div class="form-group col-md-10">
                                                                        <textarea class="col-md-12" id="Others" name="Others" ng-model="INMEDIKApp.ConsultFile.patientAux.ahfaux.commentsAux.comments" maxlength="1000" rows="3" placeholder="Otros"></textarea>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div id="APP-tab" class="tab-pane fade">
                                                        <div class="form-horizontal">
                                                            <div class="form-group">
                                                                <div class="form-group col-md-12">
                                                                    <label class="control-label col-md-2">Enfermedades actuales: </label>
                                                                    <div class="col-md-10">
                                                                        <div class="form-group col-md-2">
                                                                            <input type="checkbox" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.disease" />
                                                                        </div>
                                                                        <div class="form-group col-md-12" ng-show="INMEDIKApp.ConsultFile.patientAux.appAux.disease">
                                                                            <div class="col-md-5">
                                                                                <label class="control-label">Hipertension Arterial: <input type="checkbox" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.hta" /> </label>
                                                                            </div>
                                                                            <div class="col-md-5">
                                                                                <label class="control-label">Diabetes:  <input type="checkbox" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.dm" /> </label>
                                                                            </div>
                                                                            <div class="col-md-8">
                                                                                <textarea id="Currentdisease" name="Currentdisease" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.currentDisease" class="col-md-12" maxlength="500" rows="3" placeholder="Otra"></textarea>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group col-md-12">
                                                                    <label class="control-label col-md-2">Quirúrgicos: </label>
                                                                    <div class="col-md-10">
                                                                        <div class="form-group col-md-2">
                                                                            <input type="checkbox" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.surgical" />
                                                                        </div>
                                                                        <div class="form-group col-md-10" ng-show="INMEDIKApp.ConsultFile.patientAux.appAux.surgical">
                                                                            <textarea id="Surgical" name="Surgical" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.surgical_string" class="col-md-12" maxlength="500" rows="3" placeholder="Quirúrgicos"></textarea>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group col-md-12">
                                                                    <label class="control-label col-md-2">Transfusionales: </label>
                                                                    <div class="col-md-10">
                                                                        <div class="form-group col-md-2">
                                                                            <input type="checkbox" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.transfuctional" />
                                                                        </div>
                                                                        <div class="form-group col-md-10" ng-show="INMEDIKApp.ConsultFile.patientAux.appAux.transfuctional">
                                                                            <textarea id="Transfunctional" name="Transfunctional" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.transfunctional_string" class="col-md-12" maxlength="500" rows="3" placeholder="Transfusionales"></textarea>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group col-md-12">
                                                                    <label class="control-label col-md-2">Traumatológicos: </label>
                                                                    <div class="col-md-10">
                                                                        <div class="form-group col-md-2">
                                                                            <input type="checkbox" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.trauma" />
                                                                        </div>
                                                                        <div class="form-group col-md-10" ng-show="INMEDIKApp.ConsultFile.patientAux.appAux.trauma">
                                                                            <textarea id="Trauma" name="Trauma" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.trauma_string" class="col-md-12" maxlength="500" rows="3" placeholder="Trauma"></textarea>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group col-md-12">
                                                                    <label class="control-label col-md-2">Internamientos previos: </label>
                                                                    <div class="col-md-10">
                                                                        <div class="form-group col-md-2">
                                                                            <input type="checkbox" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.previousInternals" />
                                                                        </div>
                                                                        <div class="form-group col-md-10" ng-show="INMEDIKApp.ConsultFile.patientAux.appAux.previousInternals">
                                                                            <textarea id="Internments" name="Internments" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.previousInternals_string" class="col-md-12" maxlength="500" rows="3" placeholder="Internamientos previos"></textarea>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group col-md-12">
                                                                    <label class="control-label col-md-2">Alérgicos: </label>
                                                                    <div class="col-md-10">
                                                                        <div class="form-group col-md-2">
                                                                            <input type="checkbox" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.allergic" />
                                                                        </div>
                                                                        <div class="form-group col-md-10" ng-show="INMEDIKApp.ConsultFile.patientAux.appAux.allergic">
                                                                            <textarea id="Allergic" name="Allergic" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.allergic_string" class="col-md-12" maxlength="500" rows="3" placeholder="Alérgicos"></textarea>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <label class="control-label col-md-2">Adicciones: </label>
                                                                <br /><br />
                                                                <div class="form-group col-md-12">
                                                                    <div class="col-md-10">
                                                                        <label class="col-md-2">Tabaco: </label>
                                                                        <div class="form-group col-md-3">
                                                                            <label class="col-md-4">Si</label>
                                                                            <input type="radio" class="col-md-3" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.tobacco_question" value="SI" />
                                                                        </div>
                                                                        <div class="form-group col-md-3">
                                                                            <label class="col-md-4">No</label>
                                                                            <input type="radio" class="col-md-3" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.tobacco_question" value="NO" />
                                                                        </div>
                                                                        <div class="form-group col-md-3">
                                                                            <label class="col-md-6">Ya no</label>
                                                                            <input type="radio" class="col-md-3" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.tobacco_question" value="YA_NO" />
                                                                        </div>
                                                                    </div>
                                                                    <label class="control-label col-md-2"></label>
                                                                    <div class="form-group col-md-10" ng-show="INMEDIKApp.ConsultFile.patientAux.appAux.tobacco_question == 'SI' || INMEDIKApp.ConsultFile.patientAux.appAux.tobacco_question == 'YA_NO'">
                                                                        <textarea id="SpecificationTabaco" name="Specification" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.tobacco_string" maxlength="500" rows="2" placeholder="Especifique" class="col-md-12"></textarea>
                                                                    </div>
                                                                    <label class="control-label col-md-2"></label>
                                                                    <div class="col-md-10">
                                                                        <label class="col-md-2">Alcohol: </label>
                                                                        <div class="form-group col-md-3">
                                                                            <label class="col-md-4">Si</label>
                                                                            <input type="radio" class="col-md-3" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.alcohol_question" value="SI" />
                                                                        </div>
                                                                        <div class="form-group col-md-3">
                                                                            <label class="col-md-4">No</label>
                                                                            <input type="radio" class="col-md-3" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.alcohol_question" value="NO" />
                                                                        </div>
                                                                        <div class="form-group col-md-3">
                                                                            <label class="col-md-6">Ya no</label>
                                                                            <input type="radio" class="col-md-3" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.alcohol_question" value="YA_NO" />
                                                                        </div>
                                                                    </div>
                                                                    <label class="control-label col-md-2"></label>
                                                                    <div class="form-group col-md-10" ng-show="INMEDIKApp.ConsultFile.patientAux.appAux.alcohol_question == 'SI' || INMEDIKApp.ConsultFile.patientAux.appAux.alcohol_question == 'YA_NO'">
                                                                        <textarea id="SpecificationAlcohol" name="Specification" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.alcohol_string" maxlength="500" rows="2" placeholder="Especifique" class="col-md-12"></textarea>
                                                                    </div>
                                                                    <label class="control-label col-md-2"></label>
                                                                    <div class="col-md-10">
                                                                        <label class="col-md-2">Drogas: </label>
                                                                        <div class="form-group col-md-3">
                                                                            <label class="col-md-4">Si</label>
                                                                            <input type="radio" class="col-md-3" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.drugs_question" value="SI" />
                                                                        </div>
                                                                        <div class="form-group col-md-3">
                                                                            <label class="col-md-4">No</label>
                                                                            <input type="radio" class="col-md-3" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.drugs_question" value="NO" />
                                                                        </div>
                                                                        <div class="form-group col-md-3">
                                                                            <label class="col-md-6">Ya no</label>
                                                                            <input type="radio" class="col-md-3" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.drugs_question" value="YA_NO" />
                                                                        </div>
                                                                    </div>
                                                                    <label class="control-label col-md-2"></label>
                                                                    <div class="form-group col-md-10" ng-show="INMEDIKApp.ConsultFile.patientAux.appAux.drugs_question == 'SI' || INMEDIKApp.ConsultFile.patientAux.appAux.drugs_question == 'YA_NO'">
                                                                        <textarea id="SpecificationDrugs" name="Specification" ng-model="INMEDIKApp.ConsultFile.patientAux.appAux.drugs_string" maxlength="500" rows="2" placeholder="Especifique" class="col-md-12"></textarea>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div id="APNP-tab" class="tab-pane fade">
                                                        <div class="form-horizontal">
                                                            <div class="form-group">
                                                                <div class="col-md-12">
                                                                    <div class="form-group">
                                                                        <label class="control-label col-md-2">Vivienda: </label>
                                                                        <div class="col-md-10">
                                                                            <textarea id="LivingPlace" name="LivingPlace" maxlength="500" rows="2" placeholder="Vivienda" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.patientAux.apnpAux.livingPlace"></textarea>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-12">
                                                                    <div class="form-group">
                                                                        <label class="control-label col-md-2">Alimentación: </label>
                                                                        <div class="col-md-10">
                                                                            <textarea id="Feed" name="Feed" maxlength="500" rows="2" placeholder="Alimentación" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.patientAux.apnpAux.feeding"></textarea>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-12">
                                                                    <div class="form-group">
                                                                        <label class="control-label col-md-2">Higiene: </label>
                                                                        <div class="col-md-10">
                                                                            <textarea id="Hygiene" name="Hygiene" maxlength="500" rows="2" placeholder="Higiene" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.patientAux.apnpAux.hygiene"></textarea>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-12">
                                                                    <div class="form-group">
                                                                        <label class="control-label col-md-2">Actividad Física: </label>
                                                                        <div class="col-md-10">
                                                                            <textarea id="PhysicalActivity" name="PhysicalActivity" maxlength="500" rows="2" placeholder="Actividad Física" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.patientAux.apnpAux.physicalActivity"></textarea>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div id="ModifiedBy-tab" class="tab-pane fade">
                                                        <div class="form-horizontal">
                                                            <h3>Últimas modificaciónes:</h3><br>
                                                            <div class="form-group">
                                                                <div class="col-md-12 form-group" ng-repeat="Update in INMEDIKApp.LatestUpdates.Update track by $index">
                                                                    -{{Update}}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                                    <div class="btn btn-primary" data-loading-text="Guardando..." @*ng-disabled="dt.saving"*@ ng-click="INMEDIKApp.SaveClinicHistoryElements()">Guardar</div>
                                </div>
                            </div>
                            @* fin historia clinica *@
                            @* inicio panel servicios *@
                            <div id="Serv-tab" class="tab-pane">
                                <div class="form-horizontal">
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <div class="col-md-12 pull-right">
                                                
                                                <div style="text-align: initial;">
                                                    <label for="state" class="control-label" style="margin-right:1rem;">Tipo<span class="required">*</span>: </label>
                                                    <button type="button" class="btn btn-default" ng-click="INMEDIKApp.validateatention('Servicios')">Servicios</button>
                                                    <button type="button" class="btn btn-default" ng-click="INMEDIKApp.validateatention('Medicamentos')">Medicamentos</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    @*inicio servicios*@
                                <div class="form-group">
                                    <div class="col-md-12" ng-repeat="services in INMEDIKApp.ConsultFile.servicenoteAux">
                                        <div class="panel panel-default">
                                            <div class="panel panel-heading">
                                                <span id="btncollapse" class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#panelserv{{$index}}"><i class="fas fa-bars"></i></span>
                                                <span class="btn btn-warning btn-xs pull-left col-md-1" ng-click="INMEDIKApp.SaveServiceElements(services,$index,INMEDIKApp.ConsultFile.id,false, type)">Guardar  <i class="fa fa-folder"></i></span>
                                                <label class="col-md-2">Creada el día: {{services.sCreated}}</label>
                                                <label class="col-md-2">Tipo: Servicios</label>
                                                <label class="col-md-2">Doctor: {{services.createdby}}</label>
                                                <span ng-show="services.filesAux.length > 0" class="col-md-1"><i class="fas fa-file-image fa-2x col-lg-offset-8"></i></span>
                                                <span class="btn btn-danger btn-xs pull-right" ng-click="INMEDIKApp.ServiceModal($index, service)"><i class="fa fa-times"></i></span>
                                                <div class="clearfix"></div>
                                            </div>
                                            <div class="panel panel-heading" style="background-color: #ff1a1a" ng-if="evolution.IsCancelled">
                                                <span class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#panelBody{{$index}}"><i class="fas fa-bars"></i></span>
                                                <span class="btn btn-warning btn-xs pull-left col-md-1" ng-click="INMEDIKApp.SaveServiceElements(services,$index,INMEDIKApp.ConsultFile.id,false)">Guardar  <i class="fa fa-folder"></i></span>
                                                <label class="col-md-2">Creada el día: {{services.sCreated}}</label>
                                                <label class="col-md-2">Tipo: Servicios</label>
                                                <label class="col-md-2">Doctor: {{services.userCreated}}</label>
                                                <span ng-show="services.filesAux.length > 0" class="col-md-1"><i class="fas fa-file-image fa-2x col-lg-offset-8"></i></span>
                                                <label class="col-md-1 pull-right">Cancelado</label>
                                                <div class="clearfix"></div>
                                            </div>
                                            <div class="panel-body collapse" id="panelserv{{$index}}">
                                                <div class="col-md-12">
                                                    <div class="col-md-1">
                                                        <ul class="nav nav-pills">
                                                            <li class="active">
                                                                <a ng-click="type = 'Servicio'" href="#Service{{$index}}-tab" data-toggle="tab" data-placement="right" data-container="body" title="Servicio">
                                                                    Servicio
                                                                </a>
                                                            </li>
                                                            <li>
                                                                <a href="#DiagnosticServ{{$index}}-tab" data-toggle="tab" data-placement="right" data-container="body" title="Diagnósticos o problemas clínicos" ng-click="INMEDIKApp.ActiveCIE10Catalog('Problemas',$index)">
                                                                    Diagnósticos
                                                                </a>
                                                            </li>
                                                            @*<li>
                                                                <a href="#ImagenServ{{$index}}-tab" data-toggle="tab" data-placement="right" data-container="body" title="Imagen">
                                                                    Imagen
                                                                </a>
                                                            </li>*@
                                                            <li>
                                                                <a href="#CommentsServ{{$index}}-tab" data-toggle="tab" data-placement="right" data-container="body" title="Receta">
                                                                    Receta
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    <div class="col-md-11">
                                                        <div class="tab-content">
                                                            <div id="Service{{$index}}-tab" class="tab-pane fade in active">
                                                                <div class="form-group col-md-12">
                                                                    <div class="form-group">
                                                                        <div class="col-md-8">
                                                                            <div class="form-group">
                                                                                <label class="control-label col-md-2" for="ConsultTipe">Tipo: </label>
                                                                                <div class="col-md-9">
                                                                                    <input ng-click="type = 'Servicios'" type="text" ng-disabled="evolution.id > 0" placeholder="Escribir nombre" id="name{{type}}" name="ConsultTipe"
                                                                                           ng-model="services.conceptAux.name"
                                                                                           uib-typeahead="item.name for item in INMEDIKApp.loadConcepts($viewValue,type)"
                                                                                           typeahead-loading="loading[type]"
                                                                                           typeahead-editable="false"
                                                                                           typeahead-no-results="noResult[type]" class="form-control"
                                                                                           typeahead-on-select="INMEDIKApp.setConceptSelected($item,type)"
                                                                                           autocomplete="off" />
                                                                                    <span class="text-danger" ng-show="noResult[type]">No se encontro coincidencias</span>
                                                                                    <span class="text-primary" ng-show="loading[type]">Buscando...</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group col-md-12">
                                                                        <div class="col-md-12">
                                                                            <div class="form-group col-md-12">
                                                                                <label class="col-md-1">Notas: </label>
                                                                                <div class="col-md-11">
                                                                                    <textarea id="Habitus" name="Habitus" maxlength="1000" rows="5" placeholder="Notas" class="col-md-12" ng-model="services.notes"></textarea>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div id="ImagenServ{{$index}}-tab" class="tab-pane fade">
                                                                <div class="form-horizontal">
                                                                    <span class="btn btn-primary btn-xs pull-right col-md-1" ng-click="INMEDIKApp.AddFileService(services)" ng-disabled="evolution.id > 0"> <i class="fa fa-plus"></i></span>
                                                                </div>
                                                                <div class="clearfix"></div>
                                                                <div class="form-horizontal text-center">
                                                                    <div class="form-group" ng-repeat="files in services.filesAux">
                                                                        <br />
                                                                        <div class="col-md-12">
                                                                            <span ng-disabled="evolution.id > 0" class="btn btn-danger btn-xs pull-right col-md-1" ng-click="INMEDIKApp.RemoveFileModal(services, $index)"><i class="fa fa-times"></i></span>
                                                                        </div>
                                                                        <div class="col-md-12">
                                                                            <div class="form-group col-md-12">
                                                                                <input ng-disabled="evolution.id > 0" type="file" id="img-{{$index}}" name="img-{{$index}}" ng-model="files.image" accept="image/*" ngf-select ngf-model-invalid="errorFile" onchange="previewFile(this)" ng-click="INMEDIKApp.sendIdx($index)" /><br />
                                                                                <img src="" ng-src="@Url.Action("GetEvImage","Ads")?evId={{files.id}}" class="preview-img" alt="Image preview..." /><br />
                                                                                <textarea id="IDescription" name="ImageDescription" maxlength="500" rows="5" ng-model="files.Description" ng-disabled="files.image == undefined && files.OriginalName == undefined || evolution.IsCancelled" placeholder="Descripción" class="col-md-12"></textarea>
                                                                            </div>
                                                                        </div>
                                                                        <label class="pull-right">Última modificación:{{files.sCreated}}</label>
                                                                    </div>
                                                                </div>
                                                                <div class="clearfix"></div>
                                                                <div class="form-horizontal">
                                                                </div>
                                                            </div>
                                                            <div id="DiagnosticServ{{$index}}-tab" class="tab-pane fade">
                                                                <div class="form-horizontal">
                                                                    <div class="form-group">
                                                                        <div class="col-md-12">
                                                                            <div class="col-md-12 pull-right">
                                                                                <label class="col-md-3 pull-right">Nuevo Diagnóstico <button ng-disabled="evolution.id > 0" id="addEvolDiagnosis" class="btn btn-info btn-xs col-md-3 pull-right" ng-click="INMEDIKApp.addDiagnosticServ(services)"><i class="fa fa-folder" aria-hidden="true"></i></button></label>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group col-md-12">
                                                                        <div class="form-group col-md-12" style="margin: 20px !important" ng-repeat="servDiagnosis in services.diagnosticAux">
                                                                            <div class="panel panel-default">
                                                                                <div class="panel-heading">
                                                                                    <span class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#diagnosticpanelBodyResults{{$parent.$index}}-{{$index}}"><i class="fas fa-bars"></i></span>
                                                                                    <span class="btn btn-danger btn-xs pull-right" ng-click="INMEDIKApp.DeleteDiagnosis(services,$index)" ng-disabled="evolution.id > 0"><i class="fa fa-times"></i></span>
                                                                                    <label class="col-md-4">Diagnóstico: {{servDiagnosis.name}}</label>
                                                                                    <div class="clearfix"></div>
                                                                                </div>
                                                                                <div class="panel-body in" id="diagnosticpanelBodyResults{{$parent.$index}}-{{$index}}">
                                                                                    <div class="form-group col-md-12">
                                                                                        <label class="col-md-4">Diagnósticos o problemas clínicos:</label>
                                                                                        <div class="col-md-8">
                                                                                            <input class="col-md-11" ng-model="servDiagnosis.name" readonly />
                                                                                            <button ng-disabled="evolution.id > 0" id="addDisease" style="padding: 3px 5px !important" class="btn btn-info btn-xs col-md-1" ng-click="INMEDIKApp.showCIE10($index, type = 'servicio')"><i class="fa fa-list-ul" aria-hidden="true"></i></button>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="form-group col-md-12">
                                                                                        <label class="col-md-2">Pronostico: </label>
                                                                                        <div class="col-md-10">
                                                                                            <textarea id="Pronostic" type="text" name="Pronostic" maxlength="500" rows="2" ng-model="servDiagnosis.pronostic" ng-disabled="servDiagnosis.name == undefined||evolution.id > 0" placeholder="Pronostico" class="form-control col-md-12"></textarea>
                                                                                        </div>
                                                                                    </div>

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div id="CommentsServ{{$index}}-tab" class="tab-pane fade">
                                                                <div class="form-horizontal">
                                                                    <div class="form-group col-md-12">
                                                                        <div class="col-md-12">
                                                                            <label class="col-md-1">Receta:</label>
                                                                            <textarea class="col-md-12" placeholder="Receta" rows="10" maxlength="1000" ng-model="services.recipeAux.recipe"></textarea>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-12">
                                                                    <button id="printDisease" class="btn btn-info btn-xs col-md-2 pull-right" style="margin: 4px" ng-click="INMEDIKApp.ShowPdfPrenscription(services,$index,INMEDIKApp.ConsultFile.id,true)" ng-disabled="INMEDIKApp.subbmiting">Imprimir</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    @*fin servicios*@
                                    @*inicio medicamentos*@
                                    <div class="form-group">
                                        <div class="col-md-12" ng-repeat="medicam in INMEDIKApp.ConsultFile.medicnoteAux">
                                            <div class="panel panel-default">
                                                <div class="panel panel-heading">
                                                    <span id="btncollapse" class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#panelmed{{$index}}"><i class="fas fa-bars"></i></span>
                                                    <span class="btn btn-warning btn-xs pull-left col-md-1" ng-click="INMEDIKApp.SaveMedicamentElements(medicamentstock, medicam, INMEDIKApp.selectedconcept)">Guardar  <i class="fa fa-folder"></i></span>
                                                    <label class="col-md-2">Creada el día: {{medicam.sCreated}}</label>
                                                    <label class="col-md-2">Tipo:Medicamento {{medicam.conceptAux.name}}</label>
                                                    <label class="col-md-2">Doctor: {{medicam.createdby}}</label>
                                                    <span ng-show="evolution.filesAux.length > 0" class="col-md-1"><i class="fas fa-file-image fa-2x col-lg-offset-8"></i></span>
                                                    <span class="btn btn-danger btn-xs pull-right" ng-click="INMEDIKApp.MedicModal($index, medicament)"><i class="fa fa-times"></i></span>
                                                    <div class="clearfix"></div>
                                                </div>
                                                <div class="panel panel-heading" style="background-color: #ff1a1a" ng-if="evolution.IsCancelled">
                                                    <span class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#panelBody{{$index}}"><i class="fas fa-bars"></i></span>
                                                    <span class="btn btn-warning btn-xs pull-left col-md-1" ng-click="INMEDIKApp.SaveMedicamentElements(evolution,$index,INMEDIKApp.ConsultFile.id,false)">Guardar  <i class="fa fa-folder"></i></span>
                                                    <label class="col-md-2">Creada el día: {{medicam.sCreated}}</label>
                                                    <label class="col-md-2">Tipo:Medicamento</label>
                                                    <label class="col-md-2">Doctor: {{medicam.userCreated}}</label>
                                                    <span ng-show="evolution.filesAux.length > 0" class="col-md-1"><i class="fas fa-file-image fa-2x col-lg-offset-8"></i></span>
                                                    <label class="col-md-1 pull-right">Cancelado</label>
                                                    <div class="clearfix"></div>
                                                </div>
                                                <div class="panel-body collapse" id="panelmed{{$index}}">
                                                    <div class="col-md-12">
                                                        <div class="col-md-2">
                                                            <ul class="nav nav-pills">
                                                                <li class="active">
                                                                    <a href="#Medic{{$index}}-tab" data-toggle="tab" data-placement="right" data-container="body" ng-click="INMEDIKApp.ActiveCIE10Catalog('Evolucion')" title="Cuadro clínico">
                                                                        Medicamentos
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <a href="#DiagnosticEvolMedc{{$index}}-tab" data-toggle="tab" data-placement="right" data-container="body" title="Diagnósticos o problemas clínicos" ng-click="INMEDIKApp.ActiveCIE10Catalog('Problemas',$index)">
                                                                        Diagnósticos
                                                                    </a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="col-md-10">
                                                            <div class="tab-content">
                                                                <div id="Medic{{$index}}-tab" class="tab-pane fade in active">
                                                                    <div class="form-group col-md-12">
                                                                        <div class="col-md-12">
                                                                            <button id="medicId" class="btn btn-success btn-xs col-md-2 pull-right" style="margin: 4px" ng-click="INMEDIKApp.medicstock(medicam)"> Agregar Medicamento</button>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group col-md-12">
                                                                        <div class="col-md-12">
                                                                            <div class="col-md-4">
                                                                                <label>Medicamento</label>
                                                                            </div>
                                                                            <div class="col-md-3">
                                                                                <label>En Stock</label>
                                                                            </div>
                                                                            <div class="col-md-3">
                                                                                <label>Cantidad</label>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div id="stock{{index}}" class="form-group col-md-12" ng-repeat="medicamentstock in medicam.medicamstock">
                                                                        <div class="col-md-4">
                                                                            <input type="text" placeholder="Escribir nombre o Código" name="conceptAux"
                                                                                   ng-model="medicamentstock.medicamento"
                                                                                   uib-typeahead="item as item.name for item in INMEDIKApp.loadConcepts($viewValue,'Medicamentos')"
                                                                                   typeahead-loading="loading"
                                                                                   typeahead-editable="false"
                                                                                   typeahead-on-select="INMEDIKApp.SelectMedicament(medicamentstock.medicamento, medicam)"
                                                                                   typeahead-no-results="noResult" class="form-control"
                                                                                   autocomplete="off" required />
                                                                        </div>
                                                                        <div class="col-md-3">
                                                                            <input type="text" class="form-control" id="batch{{$index}}" name="quantity" placeholder="Lote" maxlength="50"
                                                                                   ng-model="medicamentstock.stock"
                                                                                   uib-typeahead="item as item.inStock for item in INMEDIKApp.loadConcepts($viewValue,'Medicamentos')" />
                                                                        </div>
                                                                        <div class="col-md-3">
                                                                            <input type="number" class="form-control" ng-model="medicamentstock.quantity" ng-blur="INMEDIKApp.GetTouched($event)" min="{{movement.minQuantity}}" id="quantity" required name="quantity_{{$index}}" placeholder="Cantidad" maxlength="50">
                                                                            <span class="label label-danger" ng-show="InvoiceForm['quantity_' + $index].$touched && InvoiceForm['quantity_' + $index].$error.min">* La cantidad no debe ser menor a {{movement.minQuantity}}</span>
                                                                        </div>
                                                                        <div class="col-md-1" style="margin: 2px">
                                                                            <span style="padding:5px" class="btn btn-danger btn-xs pull-right" ng-click="INMEDIKApp.setDeleteMedic($index,1, medicam)"><i class="fa fa-times"></i></span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <textarea class="col-md-12" placeholder="Receta" rows="8" maxlength="100" ng-model="medicam.notes"></textarea>
                                                                        <button id="printDisease" class="btn btn-info btn-xs col-md-2 pull-right" style="margin: 4px" ng-click="INMEDIKApp.ShowPdfPrenscription(medicam,$index,INMEDIKApp.ConsultFile.id,true)" ng-disabled="INMEDIKApp.subbmiting">Imprimir</button>
                                                                    </div>
                                                                </div>
                                                                <div id="DiagnosticEvolMedc{{$index}}-tab" class="tab-pane fade">
                                                                    <div class="form-horizontal">
                                                                        <div class="form-group">
                                                                            <div class="col-md-12">
                                                                                <div class="col-md-12 pull-right">
                                                                                    <label class="col-md-3 pull-right">Nuevo Diagnóstico <button ng-disabled="evolution.id > 0" id="addEvolDiagnosis" class="btn btn-info btn-xs col-md-3 pull-right" ng-click="INMEDIKApp.addMedicamDiagnosis(medicam)"><i class="fa fa-folder" aria-hidden="true"></i></button></label>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <div class="col-md-12" ng-repeat="medicDiagnostic in medicam.diagnosticAux">
                                                                                <div class="panel panel-default">
                                                                                    <div class="panel-heading">
                                                                                        <span class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#medicpanelBodyResults{{$parent.$index}}-{{$index}}"><i class="fas fa-bars"></i></span>
                                                                                        <span class="btn btn-danger btn-xs pull-right" ng-click="INMEDIKApp.DeleteDiagnosis(medicam,$index)" ng-disabled="medicDiagnostic.id > 0"><i class="fa fa-times"></i></span>
                                                                                        <label class="col-md-4">Diagnóstico: {{medicDiagnostic.name}}</label>
                                                                                        <div class="clearfix"></div>
                                                                                    </div>
                                                                                    <div class="panel-body in" id="medicpanelBodyResults{{$parent.$index}}-{{$index}}">
                                                                                        <div class="form-group col-md-12">
                                                                                            <label class="col-md-4">Diagnósticos o problemas clínicos:</label>
                                                                                            <div class="col-md-8">
                                                                                                <input class="col-md-11" ng-model="medicDiagnostic.name" readonly />
                                                                                                <button ng-disabled="evolution.id > 0" id="addDisease" style="padding: 3px 5px !important" class="btn btn-info btn-xs col-md-1" ng-click="INMEDIKApp.showCIE10($index)"><i class="fa fa-list-ul" aria-hidden="true"></i></button>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="form-group col-md-12">
                                                                                            <label class="col-md-2">Pronostico: </label>
                                                                                            <div class="col-md-10">
                                                                                                <textarea id="Pronostic" type="text" name="Pronostic" maxlength="500" rows="2" ng-model="medicDiagnostic.pronostic" ng-disabled="medicDiagnostic.id > 0" placeholder="Pronostico" class="form-control col-md-12"></textarea>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div id="CommentsMedc{{$index}}-tab" class="tab-pane fade">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    @*fin medicamentos*@
                                </div>
                            </div>
                            @* fin servicios *@
                            @* inicio panel aparatos y sistemas *@
                            <div id="AS-tab" class="tab-pane fade">
                                <div class="form-horizontal">
                                    <div class="col-mmd-6">
                                        <h3>Aparatos y sistemas</h3>
                                    </div>
                                    <div class="form-group col-md-12">
                                        <div class="col-md-6">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Respiratorio: </label>
                                                    <div class="col-md-8">
                                                        <textarea @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ id="Respiratory" name="Respiratory" maxlength="500" rows="3" placeholder="Respiratorio" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.deviceAndSystemsAux.respiratory"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Cardiovascular: </label>
                                                    <div class="col-md-8">
                                                        <textarea @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ id="Cardiovascular" name="Cardiovascular" maxlength="500" rows="3" placeholder="Cardiovascular" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.deviceAndSystemsAux.cardiovascular"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Digestivo: </label>
                                                    <div class="col-md-8">
                                                        <textarea @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ id="Digestive" name="Digestive" maxlength="500" rows="3" placeholder="Digestivo" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.deviceAndSystemsAux.digestive"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Urinario: </label>
                                                    <div class="col-md-8">
                                                        <textarea @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ id="Urinary" name="Urinary" maxlength="500" rows="3" placeholder="Urinario" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.deviceAndSystemsAux.urinary"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Musculoesquelético: </label>
                                                    <div class="col-md-8">
                                                        <textarea @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ id="Musculoskeletal" name="Musculoskeletal" maxlength="500" rows="3" placeholder="Musculoesquelético" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.deviceAndSystemsAux.musculoskeletal"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Genital: </label>
                                                    <div class="col-md-8">
                                                        <textarea @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ id="Genital" name="Genital" maxlength="500" rows="3" placeholder="Genital" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.deviceAndSystemsAux.genital"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class=" col-md-6">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Hematológico: </label>
                                                    <div class="col-md-8">
                                                        <textarea @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ id="Hematological" name="Hematological" maxlength="500" rows="3" placeholder="Hematológico" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.deviceAndSystemsAux.hematological"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Endócrino: </label>
                                                    <div class="col-md-8">
                                                        <textarea @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ id="Endocrine" name="Endocrine" maxlength="500" rows="3" placeholder="Endócrino" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.deviceAndSystemsAux.endocrine"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Nervioso: </label>
                                                    <div class="col-md-8">
                                                        <textarea @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ id="Nervous" name="Nervous" maxlength="500" rows="3" placeholder="Nervioso" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.deviceAndSystemsAux.nervous"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Psicosomático: </label>
                                                    <div class="col-md-8">
                                                        <textarea @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ id="Psychosomatic" name="Psychosomatic" maxlength="500" rows="3" placeholder="Psicosomático" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.deviceAndSystemsAux.psychosomatic"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label col-md-4">Otros: </label>
                                                    <div class="col-md-8">
                                                        <textarea @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ id="Others" name="Others" maxlength="500" rows="3" placeholder="Otros" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.deviceAndSystemsAux.others"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                                    <div class="btn btn-primary" data-loading-text="Guardando..." @*ng-disabled="dt.saving"*@ ng-click="INMEDIKApp.SaveExplorationElements()">Guardar</div>
                                </div>
                            </div>
                            @* fin aparatos y sistemas *@
                            @* inicio panel exploracion fisica *@
                            <div id="Physical-tab" class="tab-pane fade">
                                <div class="form-horizontal">
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <div class="col-md-2">
                                                <ul class="nav nav-sidebar"></ul>
                                            </div>
                                            <div class="col-md-10">
                                                <div class="tab-content">

                                                    <div id="Exploration-tab" class="tab-pane fade in active">
                                                        <div class="form-horizontal">
                                                            <div class="form-group col-md-12">
                                                                <label class="col-md-2">Hábitus exterior: </label>
                                                                <div class="col-md-10">
                                                                    <textarea ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined" id="Habitus" name="Habitus" maxlength="500" rows="3" placeholder="Hábitus exterior" class="col-md-12" ng-model="INMEDIKApp.ConsultFile.explorationAux.habitus"></textarea>
                                                                </div>
                                                            </div>
                                                            <div class="form-group col-md-12">
                                                                <label class="col-md-2">
                                                                    Temperatura:
                                                                    <span class="label label-default" ng-if="INMEDIKApp.ConsultFile.explorationAux.temperature>=36 && INMEDIKApp.ConsultFile.explorationAux.temperature<37">Normal</span>
                                                                    <span class="label label-danger" ng-if="INMEDIKApp.ConsultFile.explorationAux.temperature>=38">Fiebre</span>
                                                                    <span class="label label-warning" ng-if="INMEDIKApp.ConsultFile.explorationAux.temperature>=37.5 && INMEDIKApp.ConsultFile.explorationAux.temperature<=37.9">Febrícula</span>
                                                                    <span class="label label-info" ng-if="INMEDIKApp.ConsultFile.explorationAux.temperature<36 && INMEDIKApp.ConsultFile.explorationAux.temperature > 1">Hipotermia</span>
                                                                </label>
                                                                <div class="col-md-10">
                                                                    <input ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined" type="number" min="1" class="col-md-2" ng-model="INMEDIKApp.ConsultFile.explorationAux.temperature" autocomplete="off" /><span class="col-md-1"> C°</span>
                                                                    @*<span class="label label-danger" ng-if="INMEDIKApp.ConsultFile.explorationAux.temperature>=38">Fiebre</span>
                                                                        <span class="label label-warning" ng-if="INMEDIKApp.ConsultFile.explorationAux.temperature>=37.5 && INMEDIKApp.ConsultFile.explorationAux.temperature<=37.9">Febricula</span>
                                                                        <span class="label label-info" ng-if="INMEDIKApp.ConsultFile.explorationAux.temperature<36 && INMEDIKApp.ConsultFile.explorationAux.temperature > 1">Hipotermia</span>*@
                                                                </div>
                                                            </div>
                                                            <div class="form-group col-md-12">
                                                                <label class="col-md-2">
                                                                    Tensión Arterial:
                                                                    <span class="label label-default" ng-if="INMEDIKApp.ConsultFile.explorationAux.ta_sistolica<=120 && INMEDIKApp.ConsultFile.explorationAux.ta_sistolica > 1 && INMEDIKApp.ConsultFile.explorationAux.ta_diastolica > 1 && INMEDIKApp.ConsultFile.explorationAux.ta_diastolica <=80">Normal</span>
                                                                    <span class="label label-info" ng-if="INMEDIKApp.ConsultFile.explorationAux.ta_sistolica>=120.1 && INMEDIKApp.ConsultFile.explorationAux.ta_sistolica<=129.9 && INMEDIKApp.ConsultFile.explorationAux.ta_diastolica <80">Elevada</span>
                                                                    <span class="label label-warning" ng-if="(INMEDIKApp.ConsultFile.explorationAux.ta_sistolica>=130 && INMEDIKApp.ConsultFile.explorationAux.ta_sistolica<=139.9) || (INMEDIKApp.ConsultFile.explorationAux.ta_diastolica >=80 && INMEDIKApp.ConsultFile.explorationAux.ta_diastolica <=89)">Hipertensión nivel 1</span>
                                                                    <span class="label label-warning" ng-if="(INMEDIKApp.ConsultFile.explorationAux.ta_sistolica>=140 && INMEDIKApp.ConsultFile.explorationAux.ta_sistolica<=179.9) || (INMEDIKApp.ConsultFile.explorationAux.ta_diastolica >=90 && INMEDIKApp.ConsultFile.explorationAux.ta_diastolica <=119)">Hipertensión nivel 2</span>
                                                                    <span class="label label-danger" ng-if="INMEDIKApp.ConsultFile.explorationAux.ta_sistolica>=180 || INMEDIKApp.ConsultFile.explorationAux.ta_diastolica >=120">Crisis de hipertensión</span>
                                                                </label>
                                                                <div class="col-md-5">
                                                                    <label class="col-md-4">Sistólica: </label>
                                                                    <input ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined" class="col-md-5" type="number" min="1" ng-model="INMEDIKApp.ConsultFile.explorationAux.ta_sistolica" autocomplete="off" /><span class="col-md-3">mm Hg</span>
                                                                </div>
                                                                <div class="col-md-5">
                                                                    <label class="col-md-4">Diastólica: </label>
                                                                    <input ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined" class="col-md-5" type="number" min="1" ng-model="INMEDIKApp.ConsultFile.explorationAux.ta_diastolica" autocomplete="off" /><span class="col-md-3">mm Hg</span>
                                                                </div>
                                                            </div>
                                                            <div class="form-group col-md-12">
                                                                <div class="col-md-6">
                                                                    <label class="col-md-4">
                                                                        Frecuencia cardiaca:
                                                                        <span class="label label-default"
                                                                              ng-if="(INMEDIKApp.ConsultFile.patientAux.personAux.age<=2 && INMEDIKApp.ConsultFile.explorationAux.heartRate>=100 && INMEDIKApp.ConsultFile.explorationAux.heartRate<=180) || ((INMEDIKApp.ConsultFile.patientAux.personAux.age>2 && INMEDIKApp.ConsultFile.patientAux.personAux.age<=10) && INMEDIKApp.ConsultFile.explorationAux.heartRate>=60 && INMEDIKApp.ConsultFile.explorationAux.heartRate<=140) || (INMEDIKApp.ConsultFile.patientAux.personAux.age>10 && INMEDIKApp.ConsultFile.explorationAux.heartRate>=60 && INMEDIKApp.ConsultFile.explorationAux.heartRate<=100)">Normal</span>
                                                                        <span class="label label-danger"
                                                                              ng-if="(INMEDIKApp.ConsultFile.patientAux.personAux.age<=2 && INMEDIKApp.ConsultFile.explorationAux.heartRate>=181) || ((INMEDIKApp.ConsultFile.patientAux.personAux.age>2 && INMEDIKApp.ConsultFile.patientAux.personAux.age<=10) && INMEDIKApp.ConsultFile.explorationAux.heartRate>=141) || (INMEDIKApp.ConsultFile.patientAux.personAux.age>10 && INMEDIKApp.ConsultFile.explorationAux.heartRate>=101)">Taquicardia</span>
                                                                        <span class="label label-danger"
                                                                              ng-if="(INMEDIKApp.ConsultFile.patientAux.personAux.age<=2 && INMEDIKApp.ConsultFile.explorationAux.heartRate<=99 && INMEDIKApp.ConsultFile.explorationAux.heartRate > 1) || ((INMEDIKApp.ConsultFile.patientAux.personAux.age>2 && INMEDIKApp.ConsultFile.patientAux.personAux.age<=10) && INMEDIKApp.ConsultFile.explorationAux.heartRate<=59 && INMEDIKApp.ConsultFile.explorationAux.heartRate > 1) || (INMEDIKApp.ConsultFile.patientAux.personAux.age>10 && INMEDIKApp.ConsultFile.explorationAux.heartRate<=59 && INMEDIKApp.ConsultFile.explorationAux.heartRate > 1)">Bradicardia</span>
                                                                    </label>
                                                                    <div class="col-md-8">
                                                                        <input ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined" class="col-md-8" type="number" min="1" ng-model="INMEDIKApp.ConsultFile.explorationAux.heartRate" autocomplete="off" /><span class="col-md-2"> lpm</span>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label class="col-md-4">
                                                                        Frecuencia respiratoria:
                                                                        <span class="label label-default" ng-if="INMEDIKApp.ConsultFile.explorationAux.breathingFrequency>=12 && INMEDIKApp.ConsultFile.explorationAux.breathingFrequency<=20">Normal</span>
                                                                        <span class="label label-danger" ng-if="INMEDIKApp.ConsultFile.explorationAux.breathingFrequency>20">Taquipnea</span>
                                                                        <span class="label label-danger" ng-if="INMEDIKApp.ConsultFile.explorationAux.breathingFrequency<12 && INMEDIKApp.ConsultFile.explorationAux.breathingFrequency>=1">Bradipnea</span>
                                                                    </label>
                                                                    <div class="col-md-8">
                                                                        <input ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined" class="col-md-8" type="number" min="1" ng-model="INMEDIKApp.ConsultFile.explorationAux.breathingFrequency" autocomplete="off" /><span class="col-md-2"> rpm</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="form-group col-md-12">
                                                                <div class="col-md-6">
                                                                    <label class="col-md-4">
                                                                        Saturación de oxígeno:
                                                                        <span class="label label-default" ng-if="INMEDIKApp.ConsultFile.explorationAux.oxygenSaturation>=95 && INMEDIKApp.ConsultFile.explorationAux.oxygenSaturation<1">Normal</span>
                                                                        <span class="label label-danger" ng-if="INMEDIKApp.ConsultFile.explorationAux.oxygenSaturation<95 && INMEDIKApp.ConsultFile.explorationAux.oxygenSaturation>=1">Hipoxemia</span>
                                                                    </label>
                                                                    <div class="col-md-8">
                                                                        <input ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined" class="col-md-8" type="number" min="1" max="100" ng-model="INMEDIKApp.ConsultFile.explorationAux.oxygenSaturation" autocomplete="off" /><span class="col-md-2"> %</span>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label class="col-md-4">Peso </label>
                                                                    <div class="col-md-8">
                                                                        <input ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined" class="col-md-8" type="number" min="1" ng-model="INMEDIKApp.ConsultFile.explorationAux.weight" ng-change="INMEDIKApp.CalculateIMC(INMEDIKApp.ConsultFile.explorationAux.weight,INMEDIKApp.ConsultFile.explorationAux.size)" autocomplete="off" /><span class="col-md-2"> Kgs</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="form-group col-md-12">
                                                                <div class="col-md-6">
                                                                    <label class="col-md-4">Talla: </label>
                                                                    <div class="col-md-8">
                                                                        <input ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined" class="col-md-8" type="number" min="1" ng-model="INMEDIKApp.ConsultFile.explorationAux.size" ng-change="INMEDIKApp.CalculateIMC(INMEDIKApp.ConsultFile.explorationAux.weight,INMEDIKApp.ConsultFile.explorationAux.size)" autocomplete="off" /><span class="col-md-2"> Cms</span>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label class="col-md-4">Circunferencia de cadera: </label>
                                                                    <div class="col-md-8">
                                                                        <input ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined" class="col-md-8" type="number" min="1" ng-model="INMEDIKApp.ConsultFile.explorationAux.hipCircumference" autocomplete="off" /><span class="col-md-2"> Cms</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="form-group col-md-12">
                                                                <div class="col-md-6">
                                                                    <label class="col-md-4">Circunferencia de cintura: </label>
                                                                    <div class="col-md-8">
                                                                        <input ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined" class="col-md-8" type="number" min="1" ng-model="INMEDIKApp.ConsultFile.explorationAux.waistCircumference" autocomplete="off" /><span class="col-md-2"> Cms</span>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label class="col-md-4">
                                                                        IMC:
                                                                        <span class="label label-danger" ng-if="INMEDIKApp.ConsultFile.explorationAux.imc<16 && INMEDIKApp.ConsultFile.explorationAux.imc>1"> Delgadez severa</span>
                                                                        <span class="label label-warning" ng-if="INMEDIKApp.ConsultFile.explorationAux.imc>=16 && INMEDIKApp.ConsultFile.explorationAux.imc<=16.99"> Delgadez moderada</span>
                                                                        <span class="label label-warning" ng-if="INMEDIKApp.ConsultFile.explorationAux.imc>=17 && INMEDIKApp.ConsultFile.explorationAux.imc<=18.49"> Delgadez leve</span>
                                                                        <span class="label label-success" ng-if="INMEDIKApp.ConsultFile.explorationAux.imc>=18.5 && INMEDIKApp.ConsultFile.explorationAux.imc<=24.99"> Normal</span>
                                                                        <span class="label label-warning" ng-if="INMEDIKApp.ConsultFile.explorationAux.imc>=25 && INMEDIKApp.ConsultFile.explorationAux.imc<=29.99"> Preobeso</span>
                                                                        <span class="label label-warning" ng-if="INMEDIKApp.ConsultFile.explorationAux.imc>=30 && INMEDIKApp.ConsultFile.explorationAux.imc<=34.99"> Obesidad leve</span>
                                                                        <span class="label label-danger" ng-if="INMEDIKApp.ConsultFile.explorationAux.imc>=35 && INMEDIKApp.ConsultFile.explorationAux.imc<=39.99"> Obesidad media</span>
                                                                        <span class="label label-danger" ng-if="INMEDIKApp.ConsultFile.explorationAux.imc>=40"> Obesidad morbida</span>
                                                                    </label>
                                                                    <div class="col-md-8">
                                                                        <span>{{INMEDIKApp.ConsultFile.explorationAux.imc}}</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="form-group col-md-12">
                                                                <h4 class="col-md-12 text-center">Escala del dolor </h4>
                                                            </div>
                                                            <div class="form-group col-md-12">
                                                                <input ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined" type="range" class="slider-input" min="0" max="10" step="1" id="painScaleRange" ng-model="INMEDIKApp.ConsultFile.explorationAux.painScaleAdult" />
                                                                <div class="ticks">
                                                                    <span class="tick">0</span>
                                                                    <span class="tick">1</span>
                                                                    <span class="tick">2</span>
                                                                    <span class="tick">3</span>
                                                                    <span class="tick">4</span>
                                                                    <span class="tick">5</span>
                                                                    <span class="tick">6</span>
                                                                    <span class="tick">7</span>
                                                                    <span class="tick">8</span>
                                                                    <span class="tick">9</span>
                                                                    <span class="tick">10</span>
                                                                </div>
                                                            </div>
                                                            <div class="form-group col-md-12">
                                                                <div class="col-md-2">
                                                                    <label><img src="~/Content/Images/escala_del_dolor1.png" /> Sin Dolor</label>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <label><img src="~/Content/Images/escala_del_dolor2.png" /> Duele un poco</label>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <label><img src="~/Content/Images/escala_del_dolor3.png" /> Duele un poco más</label>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <label><img src="~/Content/Images/escala_del_dolor4.png" /> Duele aún más</label>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <label><img src="~/Content/Images/escala_del_dolor5.png" /> Duele mucho</label>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <label><img src="~/Content/Images/escala_del_dolor6.png" /> El peor dolor</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div id="Diagnostic-tab" class="tab-pane fade">
                                                        <div class="form-horizontal">
                                                            <div class="form-group col-md-12">
                                                                <label class="col-md-4">Diagnósticos o problemas clínicos:</label>
                                                                <div class="col-md-8">
                                                                    <input class="col-md-11" ng-model="INMEDIKApp.Diagnostic.nombre" readonly />
                                                                    <button id="addDisease" class="btn btn-info btn-xs col-md-1" ng-click="INMEDIKApp.showCIE10()"><i class="fa fa-list-ul" aria-hidden="true"></i></button>
                                                                </div>
                                                            </div>
                                                            <div class="form-group col-md-12">
                                                                <label class="col-md-2">Pronostico: </label>
                                                                <div class="col-md-10">
                                                                    <textarea type="text" id="Pronostic" name="Pronostic" maxlength="500" rows="2" ng-model="INMEDIKApp.Diagnostic.pronostic" placeholder="Pronostico" class="col-md-12"></textarea>
                                                                </div>
                                                            </div>
                                                            <div class="form-group col-md-12">
                                                                <label class="col-md-2">Recetaaaaaa: </label>
                                                                <div class="col-md-10">
                                                                    @*<h4>Plan: </h4>*@
                                                                    <div class="form-group" style="border:inset;max-width:700px;max-height:200px;min-height:200px;overflow:auto;">
                                                                        <div class="col-md-12" ng-repeat="recipe in INMEDIKApp.Recipe">
                                                                            <h5>{{recipe.nombre}}</h5>
                                                                            <ul>
                                                                                <li>{{recipe.activeSubstance}}, {{recipe.commercialBrand}}, {{recipe.presentation}}</li>
                                                                                <li>{{recipe.dose}} {{recipe.unit}}, {{recipe.frequency}}, {{recipe.wayOfAdministration}}</li>
                                                                                <li>Por(Días): {{recipe.daysOfThreatment}}</li>
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-12">
                                                                        <button id="addDisease" class="btn btn-info btn-xs col-md-2 pull-right" ng-click="INMEDIKApp.ShowPdfPrenscription(evolution,$index,INMEDIKApp.ConsultFile.id,true)">Imprimir</button>
                                                                        <button id="addDisease" class="btn btn-info btn-xs col-md-2 pull-left" ng-click="INMEDIKApp.cleanRecipe()">Limpiar</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ class="col-md-1 pull-right btn btn-primary" ng-click="INMEDIKApp.SaveExplorationElements()">Guardar</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @* fin exploracion fisica *@
                            @* inicio panel nota evolucion *@
                            <div id="Evolucion-tab" class="tab-pane fade">
                                <div class="form-horizontal">
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <div class="col-md-12 pull-right">
                                                <label class="col-md-2 pull-right">
                                                    Nueva nota 
                                                    <button id="addEvolutionNote" class="btn btn-info btn-xs col-md-3 pull-right" ng-click="INMEDIKApp.addEvolutionNote()" data-toggle="collapse" data-target="#panelBodymod0">
                                                        <i class="fa fa-folder" aria-hidden="true"></i>
                                                    </button>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12" ng-repeat="evolution in INMEDIKApp.ConsultFile.evolutionNotesAux">
                                            <div class="panel panel-default">
                                                <div class="panel panel-heading" ng-if="!evolution.IsCancelled">
                                                    <span id="btncollapse" class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#panelBodymod{{$index}}"><i class="fas fa-bars"></i></span>
                                                    <span class="btn btn-warning btn-xs pull-left col-md-1" ng-click="INMEDIKApp.SaveCurrentNote(INMEDIKApp.selectedconcept, evolution, $index, INMEDIKApp.ConsultFile.id, false, INMEDIKApp.conceptselected)">Guardar  <i class="fa fa-folder"></i></span>
                                                    <label class="col-md-2">Creada el día: {{evolution.sCreated}}</label>
                                                    <label class="col-md-2">Doctor: {{evolution.userCreated}}</label>
                                                    @*<label class="col-md-2" ng-if="evolution.sUpdated != '01/01/0001 00:00'">Modificado el día: {{evolution.sUpdated}}</label>*@
                                                    <span ng-show="evolution.filesAux.length > 0" class="col-md-1"><i class="fas fa-file-image fa-2x col-lg-offset-8"></i></span>
                                                    <span class="btn btn-danger btn-xs pull-right" ng-click="INMEDIKApp.EvolutionModal($index, evolution)"><i class="fa fa-times"></i></span>
                                                    <div class="clearfix"></div>
                                                </div>
                                                <div class="panel panel-heading" style="background-color: #ff1a1a" ng-if="evolution.IsCancelled">
                                                    <span class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#panelBody{{$index}}"><i class="fas fa-bars"></i></span>
                                                    <span class="btn btn-warning btn-xs pull-left col-md-1" ng-click="INMEDIKApp.SaveCurrentNote(evolution,$index,INMEDIKApp.ConsultFile.id,false)" @*ng-disabled="INMEDIKApp.subbmiting||evolution.IsCancelled"*@>Guardar  <i class="fa fa-folder"></i></span>
                                                    <label class="col-md-2">Creada el día: {{evolution.sCreated}}</label>
                                                    <label class="col-md-2">Diagnóstico: </label>
                                                    <label class="col-md-2">Doctor: {{evolution.userCreated}}</label>
                                                    <label class="col-md-2" ng-if="evolution.sUpdated != '01/01/0001 00:00'">Modificado el día: {{evolution.sUpdated}}</label>
                                                    <span ng-show="evolution.filesAux.length > 0" class="col-md-1"><i class="fas fa-file-image fa-2x col-lg-offset-8"></i></span>
                                                    <label class="col-md-1 pull-right">Cancelado</label>
                                                    <div class="clearfix"></div>
                                                </div>
                                                <div class="panel-body collapse" id="panelBodymod{{$index}}">
                                                    <div class="col-md-12">
                                                        <div class="col-md-2">
                                                            <ul class="nav nav-pills">
                                                                <li class="active">
                                                                    <a @*class="menu_btn"*@ href="#Vital{{$index}}-tab" data-toggle="tab" data-placement="right" data-container="body" title="Signos vitales">
                                                                        Signos vitales
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <a href="#Evolution{{$index}}-tab" data-toggle="tab" data-placement="right" data-container="body" ng-click="INMEDIKApp.ActiveCIE10Catalog('Evolucion')" title="Cuadro clínico">
                                                                        Cuadro clínico
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <a @*class="menu_btn"*@ href="#Imagen{{$index}}-tab" data-toggle="tab" data-placement="right" data-container="body" title="Imagen">
                                                                        Imagen
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <a @*class="menu_btn"*@ href="#DiagnosticEvol{{$index}}-tab" data-toggle="tab" data-placement="right" data-container="body" title="Diagnósticos o problemas clínicos" ng-click="INMEDIKApp.ActiveCIE10Catalog('Problemas',$index)">
                                                                        Diagnósticos
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <a @*class="menu_btn"*@ href="#RecipeEvol{{$index}}-tab" data-toggle="tab" data-placement="right" data-container="body" title="Diagnósticos o problemas clínicos" ng-click="INMEDIKApp.ActiveCIE10Catalog('Problemas',$index)">
                                                                        Receta
                                                                    </a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="col-md-10">
                                                            <div class="tab-content">
                                                                <div id="Evolution{{$index}}-tab" class="tab-pane fade">
                                                                    <div class="form-horizontal">
                                                                        <div class="form-group col-md-12">
                                                                            <div class="col-md-6">
                                                                                <div class="form-group">
                                                                                    <label class="control-label col-md-3" for="ConsultTipe">Tipo de consulta: </label>
                                                                                    <div class="col-md-9">
                                                                                        <input ng-click="type = 'Consultas'" type="text" ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" placeholder="Escribir nombre" id="name{{type}}" name="ConsultTipe"
                                                                                               ng-model="evolution.evolutionConditionAux.tipeConsult"
                                                                                               uib-typeahead="item.name for item in INMEDIKApp.loadConcepts($viewValue,type)"
                                                                                               typeahead-loading="loading[type]"
                                                                                               typeahead-editable="false"
                                                                                               typeahead-no-results="noResult[type]" class="form-control"
                                                                                               typeahead-on-select="INMEDIKApp.setConceptSelected($item, type)"
                                                                                               autocomplete="off" />
                                                                                        <span class="text-danger" ng-show="noResult[type]">No se encontro coincidencias</span>
                                                                                        <span class="text-primary" ng-show="loading[type]">Buscando...</span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group col-md-12">
                                                                            <div class="col-md-6">
                                                                                <div class="form-group">
                                                                                    <label class="control-label col-md-3">Motivo de consulta: </label>
                                                                                    <div class="col-md-9">
                                                                                        <textarea ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" id="Reason" name="Reason" maxlength="500" rows="3" placeholder="Motivo de consulta" class="col-md-12" ng-model="evolution.evolutionConditionAux.reasonForConsultation" title="Motivo de consulta"></textarea>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-6">
                                                                                <div class="form-group">
                                                                                    <label class="control-label col-md-3">Subjetivo: </label>
                                                                                    <div class="col-md-9">
                                                                                        <textarea ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" id="Subjective" name="Subjective" maxlength="500" rows="3" placeholder="Subjetivo" class="col-md-12" ng-model="evolution.evolutionConditionAux.subjective" title="Subjetivo"></textarea>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group col-md-12">
                                                                            <div class="col-md-6">
                                                                                <div class="form-group">
                                                                                    <label class="control-label col-md-3">Objetivo: </label>
                                                                                    <div class="col-md-9">
                                                                                        <textarea ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" id="objective" name="objective" maxlength="500" rows="3" placeholder="Objetivo" class="col-md-12" ng-model="evolution.evolutionConditionAux.objective" title="Objetivo"></textarea>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-6">
                                                                                <div class="form-group">
                                                                                    <label class="control-label col-md-3">Análisis: </label>
                                                                                    <div class="col-md-9">
                                                                                        <textarea ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" id="Analysis" name="Analysis" maxlength="500" rows="3" placeholder="Análisis" class="col-md-12" ng-model="evolution.evolutionConditionAux.analysis" title="Análisis"></textarea>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div id="Vital{{$index}}-tab" class="tab-pane fade in active">
                                                                    <div class="form-horizontal">
                                                                        <div class="form-group col-md-12">
                                                                            <div class="col-md-2">
                                                                                <label class="col-md-6">Hábitus exterior: </label>
                                                                            </div>
                                                                            <div class="col-md-10">
                                                                                <textarea ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" id="Habitus" name="Habitus" maxlength="500" rows="3" placeholder="Habitus exterior" class="col-md-12" ng-model="evolution.evolutionExplorationAux.habitus"></textarea>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group col-md-12">
                                                                            <div class="col-md-6">
                                                                                <label class="col-md-4">
                                                                                    Temperatura:
                                                                                    <span class="label label-default" ng-if="evolution.evolutionExplorationAux.temperature>=36 && evolution.evolutionExplorationAux.temperature<37">Normal</span>
                                                                                    <span class="label label-danger" ng-if="evolution.evolutionExplorationAux.temperature>=38">Fiebre</span>
                                                                                    <span class="label label-warning" ng-if="evolution.evolutionExplorationAux.temperature>=37.5 && evolution.evolutionExplorationAux.temperature<=37.9">Febricula</span>
                                                                                    <span class="label label-info" ng-if="evolution.evolutionExplorationAux.temperature<36 && evolution.evolutionExplorationAux.temperature > 1">Hipotermia</span>
                                                                                </label>
                                                                                <div class="col-md-8">
                                                                                    <input ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" type="number" min="1" class="col-md-8" ng-model="evolution.evolutionExplorationAux.temperature" autocomplete="off" /><span class="col-md-1"> C°</span>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-6">
                                                                                <label class="col-md-6">
                                                                                    Tensión Arterial:
                                                                                    <span class="label label-default" ng-if="evolution.evolutionExplorationAux.ta_sistolica<=120 && evolution.evolutionExplorationAux.ta_sistolica > 1 && evolution.evolutionExplorationAux.ta_diastolica > 1 && evolution.evolutionExplorationAux.ta_diastolica <80">Normal</span>
                                                                                    <span class="label label-info" ng-if="evolution.evolutionExplorationAux.ta_sistolica>=120.1 && evolution.evolutionExplorationAux.ta_sistolica<=129.9 && evolution.evolutionExplorationAux.ta_diastolica <80">Elevada</span>
                                                                                    <span class="label label-warning" ng-if="(evolution.evolutionExplorationAux.ta_sistolica>=130 && evolution.evolutionExplorationAux.ta_sistolica<=139.9) || (evolution.evolutionExplorationAux.ta_diastolica >=80 && evolution.evolutionExplorationAux.ta_diastolica <=89)">Hipertensión nivel 1</span>
                                                                                    <span class="label label-warning" ng-if="(evolution.evolutionExplorationAux.ta_sistolica>=140 && evolution.evolutionExplorationAux.ta_sistolica<=179.9) || (evolution.evolutionExplorationAux.ta_diastolica >=90 && evolution.evolutionExplorationAux.ta_diastolica <=119)">Hipertensión nivel 2</span>
                                                                                    <span class="label label-danger" ng-if="evolution.evolutionExplorationAux.ta_sistolica>=180 || evolution.evolutionExplorationAux.ta_diastolica >=120">Crisis de hipertensión</span>
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group col-md-12">
                                                                            <div class="col-md-6">
                                                                                <label class="col-md-4">
                                                                                    Sistólica:
                                                                                </label>
                                                                                <div class="col-md-8">
                                                                                    <input ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" class="col-md-8" type="number" min="1" ng-model="evolution.evolutionExplorationAux.ta_sistolica" autocomplete="off" /><span class="col-md-3">mm Hg</span>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-6">
                                                                                <label class="col-md-4">
                                                                                    Diastólica:
                                                                                </label>
                                                                                <div class="col-md-8">
                                                                                    <input ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" class="col-md-8" type="number" min="1" ng-model="evolution.evolutionExplorationAux.ta_diastolica" autocomplete="off" /><span class="col-md-3">mm Hg</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group col-md-12">
                                                                            <div class="col-md-6">
                                                                                <label class="col-md-4">
                                                                                    Frecuencia cardiaca:
                                                                                    <span class="label label-default"
                                                                                          ng-if="(INMEDIKApp.ConsultFile.patientAux.personAux.age<=2 && evolution.evolutionExplorationAux.heartRate>=100 && evolution.evolutionExplorationAux.heartRate<=180) || ((INMEDIKApp.ConsultFile.patientAux.personAux.age>2 && INMEDIKApp.ConsultFile.patientAux.personAux.age<=10) && evolution.evolutionExplorationAux.heartRate>=60 && evolution.evolutionExplorationAux.heartRate<=140) || (INMEDIKApp.ConsultFile.patientAux.personAux.age>10 && evolution.evolutionExplorationAux.heartRate>=60 && evolution.evolutionExplorationAux.heartRate<=100)">Normal</span>
                                                                                    <span class="label label-danger"
                                                                                          ng-if="(INMEDIKApp.ConsultFile.patientAux.personAux.age<=2 && evolution.evolutionExplorationAux.heartRate>=181) || ((INMEDIKApp.ConsultFile.patientAux.personAux.age>2 && INMEDIKApp.ConsultFile.patientAux.personAux.age<=10) && evolution.evolutionExplorationAux.heartRate>=141) || (INMEDIKApp.ConsultFile.patientAux.personAux.age>10 && evolution.evolutionExplorationAux.heartRate>=101)">Taquicardia</span>
                                                                                    <span class="label label-danger"
                                                                                          ng-if="(INMEDIKApp.ConsultFile.patientAux.personAux.age<=2 && evolution.evolutionExplorationAux.heartRate<=99 && evolution.evolutionExplorationAux.heartRate > 1) || ((INMEDIKApp.ConsultFile.patientAux.personAux.age>2 && INMEDIKApp.ConsultFile.patientAux.personAux.age<=10) && evolution.evolutionExplorationAux.heartRate<=59 && evolution.evolutionExplorationAux.heartRate > 1) || (INMEDIKApp.ConsultFile.patientAux.personAux.age>10 && evolution.evolutionExplorationAux.heartRate<=59 && evolution.evolutionExplorationAux.heartRate > 1)">Bradicardia</span>
                                                                                </label>
                                                                                <div class="col-md-8">
                                                                                    <input ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" class="col-md-8" type="number" min="1" ng-model="evolution.evolutionExplorationAux.heartRate" autocomplete="off" /><span class="col-md-2"> lpm</span>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-6">
                                                                                <label class="col-md-4">
                                                                                    Frecuencia respiratoria:
                                                                                    <span class="label label-default" ng-if="evolution.evolutionExplorationAux.breathingFrequency>=12 && evolution.evolutionExplorationAux.breathingFrequency<=20">Normal</span>
                                                                                    <span class="label label-danger" ng-if="evolution.evolutionExplorationAux.breathingFrequency>20">Taquipnea</span>
                                                                                    <span class="label label-danger" ng-if="evolution.evolutionExplorationAux.breathingFrequency<12 && evolution.evolutionExplorationAux.breathingFrequency>=1">Bradipnea</span>
                                                                                </label>
                                                                                <div class="col-md-8">
                                                                                    <input ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" class="col-md-8" type="number" min="1" ng-model="evolution.evolutionExplorationAux.breathingFrequency" autocomplete="off" /><span class="col-md-2"> rpm</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group col-md-12">
                                                                            <div class="col-md-6">
                                                                                <label class="col-md-4">
                                                                                    Saturación de oxígeno:
                                                                                    <span class="label label-default" ng-if="evolution.evolutionExplorationAux.oxygenSaturation>=95">Normal</span>
                                                                                    <span class="label label-danger" ng-if="evolution.evolutionExplorationAux.oxygenSaturation<95 && evolution.evolutionExplorationAux.oxygenSaturation>=1">Hipoxemia</span>
                                                                                </label>
                                                                                <div class="col-md-8">
                                                                                    <input ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" class="col-md-8" type="number" min="1" max="100" ng-model="evolution.evolutionExplorationAux.oxygenSaturation" autocomplete="off" /><span class="col-md-2"> %</span>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-6">
                                                                                <label class="col-md-4">Peso </label>
                                                                                <div class="col-md-8">
                                                                                    <input ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" class="col-md-8" type="number" min="1" ng-model="evolution.evolutionExplorationAux.weight" ng-change="INMEDIKApp.CalculateIMCEvolution(evolution.evolutionExplorationAux.weight,evolution.evolutionExplorationAux.size,$index)" autocomplete="off" /><span class="col-md-2"> Kgs</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group col-md-12">
                                                                            <div class="col-md-6">
                                                                                <label class="col-md-4">Talla: </label>
                                                                                <div class="col-md-8">
                                                                                    <input ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" class="col-md-8" type="number" min="1" ng-model="evolution.evolutionExplorationAux.size" ng-change="INMEDIKApp.CalculateIMCEvolution(evolution.evolutionExplorationAux.weight,evolution.evolutionExplorationAux.size,$index)" autocomplete="off" /><span class="col-md-2"> Cms</span>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-6">
                                                                                <label class="col-md-4">Circunferencia de cadera: </label>
                                                                                <div class="col-md-8">
                                                                                    <input ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" class="col-md-8" type="number" min="1" ng-model="evolution.evolutionExplorationAux.hipCircumference" autocomplete="off" /><span class="col-md-2"> Cms</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group col-md-12">
                                                                            <div class="col-md-6">
                                                                                <label class="col-md-4">Circunferencia de cintura: </label>
                                                                                <div class="col-md-8">
                                                                                    <input ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" class="col-md-8" type="number" min="1" ng-model="evolution.evolutionExplorationAux.waistCircumference" autocomplete="off" /><span class="col-md-2"> Cms</span>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-6">
                                                                                <label class="col-md-4">
                                                                                    IMC:
                                                                                    <span class="label label-danger" ng-if="evolution.evolutionExplorationAux.imc<16 && evolution.evolutionExplorationAux.imc>1"> Delgadez severa</span>
                                                                                    <span class="label label-warning" ng-if="evolution.evolutionExplorationAux.imc>=16 && evolution.evolutionExplorationAux.imc<=16.99"> Delgadez moderada</span>
                                                                                    <span class="label label-warning" ng-if="evolution.evolutionExplorationAux.imc>=17 && evolution.evolutionExplorationAux.imc<=18.49"> Delgadez leve</span>
                                                                                    <span class="label label-success" ng-if="evolution.evolutionExplorationAux.imc>=18.5 && evolution.evolutionExplorationAux.imc<=24.99"> Normal</span>
                                                                                    <span class="label label-warning" ng-if="evolution.evolutionExplorationAux.imc>=25 && evolution.evolutionExplorationAux.imc<=29.99"> Preobeso</span>
                                                                                    <span class="label label-warning" ng-if="evolution.evolutionExplorationAux.imc>=30 && evolution.evolutionExplorationAux.imc<=34.99"> Obesidad leve</span>
                                                                                    <span class="label label-danger" ng-if="evolution.evolutionExplorationAux.imc>=35 && evolution.evolutionExplorationAux.imc<=39.99"> Obesidad media</span>
                                                                                    <span class="label label-danger" ng-if="evolution.evolutionExplorationAux.imc>=40"> Obesidad morbida</span>
                                                                                </label>
                                                                                <div class="col-md-8">
                                                                                    <span>{{evolution.evolutionExplorationAux.imc}}</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group col-md-12">
                                                                            <h4 class="col-md-12 text-center">Escala del dolor </h4>
                                                                        </div>
                                                                        <div class="form-group col-md-12" @*ng-if="INMEDIKApp.ConsultFile.patientAux.personAux.age>=8"*@>
                                                                            <input ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" type="range" class="slider-input" min="0" max="10" step="1" id="painScaleRange{{$index}}" ng-model="evolution.evolutionExplorationAux.painScaleAdult" />
                                                                            <div class="ticks">
                                                                                <span class="tick">0</span>
                                                                                <span class="tick">1</span>
                                                                                <span class="tick">2</span>
                                                                                <span class="tick">3</span>
                                                                                <span class="tick">4</span>
                                                                                <span class="tick">5</span>
                                                                                <span class="tick">6</span>
                                                                                <span class="tick">7</span>
                                                                                <span class="tick">8</span>
                                                                                <span class="tick">9</span>
                                                                                <span class="tick">10</span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group col-md-12">
                                                                            <div class="col-md-2">
                                                                                <label><img src="~/Content/Images/escala_del_dolor1.png" /> Sin Dolor</label>
                                                                            </div>
                                                                            <div class="col-md-2">
                                                                                <label><img src="~/Content/Images/escala_del_dolor2.png" /> Duele un poco</label>
                                                                            </div>
                                                                            <div class="col-md-2">
                                                                                <label><img src="~/Content/Images/escala_del_dolor3.png" /> Duele un poco más</label>
                                                                            </div>
                                                                            <div class="col-md-2">
                                                                                <label><img src="~/Content/Images/escala_del_dolor4.png" /> Duele aún más</label>
                                                                            </div>
                                                                            <div class="col-md-2">
                                                                                <label><img src="~/Content/Images/escala_del_dolor5.png" /> Duele mucho</label>
                                                                            </div>
                                                                            <div class="col-md-2">
                                                                                <label><img src="~/Content/Images/escala_del_dolor6.png" /> El peor dolor</label>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div style="text-align:end">
                                                                        <div class="btn btn-primary" data-loading-text="Guardando..." ng-click="INMEDIKApp.SaveVitalSignsNote(INMEDIKApp.selectedconcept, evolution, $index, INMEDIKApp.ConsultFile.id, false, INMEDIKApp.conceptselected)" ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns">Guardar Signos Vitales</div>
                                                                    </div>
                                                                    <br /><br />
                                                                </div>
                                                                <div id="Imagen{{$index}}-tab" class="tab-pane fade">
                                                                    <div class="form-horizontal">
                                                                        <span class="btn btn-primary btn-xs pull-right col-md-1" ng-click="INMEDIKApp.AddFile(evolution)" ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns"> <i class="fa fa-plus"></i></span>
                                                                    </div>
                                                                    <br /><br />
                                                                    <div class="clearfix"></div>
                                                                    <div class="form-horizontal text-center">
                                                                        <div class="form-group" ng-repeat="files in evolution.filesAux">
                                                                            <br />
                                                                            <div class="col-md-12">
                                                                                <span ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" class="btn btn-danger btn-xs pull-right col-md-1" ng-click="INMEDIKApp.RemoveFileModal(evolution, $index)"><i class="fa fa-times"></i></span>
                                                                            </div>
                                                                            <div class="form-inline">
                                                                                <input ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" type="file" id="img-{{$index}}" name="img-{{$index}}" ng-model="files.image" accept="image/*" ngf-select ngf-model-invalid="errorFile" onchange="previewFile(this)" ng-click="INMEDIKApp.sendIdx($index)" /><br />
                                                                                <img src="" ng-src="@Url.Action("GetEvImage","Ads")?evId={{files.id}}" class="preview-img" alt="Image preview..." /><br />
                                                                                <textarea id="IDescription" name="ImageDescription" maxlength="500" rows="5" ng-model="files.Description" ng-disabled="files.image == undefined && files.OriginalName == undefined || evolution.IsCancelled || evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" placeholder="Descripción" class="col-md-12"></textarea>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="clearfix"></div>
                                                                    <div class="form-horizontal">
                                                                    </div>
                                                                </div>
                                                                <div id="DiagnosticEvol{{$index}}-tab" class="tab-pane fade">
                                                                    <div class="form-horizontal">
                                                                        <div class="form-group">
                                                                            <div class="col-md-12">
                                                                                <div class="col-md-12 pull-right">
                                                                                    <label class="col-md-3 pull-right">Nuevo Diagnóstico <button ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" id="addEvolDiagnosis" class="btn btn-info btn-xs col-md-3 pull-right" ng-click="INMEDIKApp.addDiagnosis(evolution)"><i class="fa fa-folder" aria-hidden="true"></i></button></label>
                                                                                    @*<label class="col-md-2 pull-right">Ver Receta <button class="btn btn-info btn-xs col-md-3 pull-right" ng-click="INMEDIKApp.RecipeRead()"><i class="fa fa-list-ul" aria-hidden="true"></i></button></label>*@
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <div class="col-md-12" ng-repeat="evolDiagnosis in evolution.evolutionDiagnosticAux">
                                                                                <div class="panel panel-default">
                                                                                    <div class="panel-heading">
                                                                                        <span class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#diagnosticpanelBodyResults{{$parent.$index}}-{{$index}}"><i class="fas fa-bars"></i></span>
                                                                                        <span class="btn btn-danger btn-xs pull-right" ng-click="INMEDIKApp.DeleteDiagnosis(evolution,$index)" ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns"><i class="fa fa-times"></i></span>
                                                                                        <label class="col-md-4">Diagnóstico: {{evolDiagnosis.name}}</label>
                                                                                        <div class="clearfix"></div>
                                                                                    </div>
                                                                                    <div class="panel-body in" id="diagnosticpanelBodyResults{{$parent.$index}}-{{$index}}">
                                                                                        <div class="form-group col-md-12" @*ng-if="evolDiagnosis.nombre == undefined"*@>
                                                                                            <label class="col-md-4">Diagnósticos o problemas clínicos:</label>
                                                                                            <div class="col-md-8">
                                                                                                <input class="col-md-11" ng-model="evolDiagnosis.name" readonly />
                                                                                                <button ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" id="addDisease" style="padding: 3px 5px !important" class="btn btn-info btn-xs col-md-1" ng-click="INMEDIKApp.showCIE10($index)"><i class="fa fa-list-ul" aria-hidden="true"></i></button>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="form-group col-md-12">
                                                                                            <label class="col-md-2">Pronostico: </label>
                                                                                            <div class="col-md-10">
                                                                                                <textarea id="Pronostic" type="text" name="Pronostic" maxlength="500" rows="2" ng-model="evolDiagnosis.pronostic" ng-disabled="evolDiagnosis.name == undefined||evolution.id > 0" placeholder="Pronostico" class="form-control col-md-12"></textarea>
                                                                                            </div>
                                                                                        </div>

                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div id="RecipeEvol{{$index}}-tab" class="tab-pane fade">
                                                                    <div class="form-group col-md-12">
                                                                        <div class="col-md-12">
                                                                            <button id="medicId" ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" class="btn btn-success btn-xs col-md-2 pull-right" style="margin: 4px" ng-click="INMEDIKApp.addmedicstock(evolution)"> Agregar Medicamento</button>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group col-md-12">
                                                                        <div class="col-md-12">
                                                                            <div class="col-md-4">
                                                                                <label>Medicamento</label>
                                                                            </div>
                                                                            <div class="col-md-3">
                                                                                <label>En Stock</label>
                                                                            </div>
                                                                            <div class="col-md-3">
                                                                                <label>Cantidad</label>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div id="stock{{index}}" class="form-group col-md-12" ng-repeat="medicamentstock in evolution.medicamstock">
                                                                        <div class="col-md-4">
                                                                            <input type="text" placeholder="Escribir nombre o Código" name="conceptAux"
                                                                                   ng-model="medicamentstock.medicamento" ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns"
                                                                                   uib-typeahead="item as item.name for item in INMEDIKApp.loadConcepts($viewValue,'Medicamentos')"
                                                                                   typeahead-loading="loading"
                                                                                   typeahead-editable="false"
                                                                                   typeahead-on-select="INMEDIKApp.SelectMedicament(medicamentstock.medicamento, evolution)"
                                                                                   typeahead-no-results="noResult" class="form-control"
                                                                                   autocomplete="off" required />
                                                                        </div>
                                                                        <div class="col-md-3">
                                                                            <input type="text" class="form-control" id="batch{{$index}}" name="quantity" placeholder="Lote" maxlength="50"
                                                                                   ng-model="medicamentstock.stock" ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSignss"
                                                                                   uib-typeahead="item as item.inStock for item in INMEDIKApp.loadConcepts($viewValue,'Medicamentos')" />
                                                                        </div>
                                                                        <div class="col-md-3">
                                                                            <input type="number" class="form-control" ng-model="medicamentstock.quantity" ng-blur="INMEDIKApp.GetTouched($event)" min="{{movement.minQuantity}}" id="quantity" required name="quantity_{{$index}}" placeholder="Cantidad" maxlength="50" ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns">
                                                                            <span class="label label-danger" ng-show="InvoiceForm['quantity_' + $index].$touched && InvoiceForm['quantity_' + $index].$error.min">* La cantidad no debe ser menor a {{movement.minQuantity}}</span>
                                                                        </div>
                                                                        <div class="col-md-1" style="margin: 2px">
                                                                            <span style="padding:5px" class="btn btn-danger btn-xs pull-right" ng-click="INMEDIKApp.setDeleteMedic($index,1, medicam)"><i class="fa fa-times"></i></span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <textarea class="col-md-12" placeholder="Receta" rows="8" maxlength="100" ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns" ng-model="evolution.objRecipe.recipe"></textarea>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div style="text-align:end">
                                                        <button type="button" id="btncollapse" class="btn btn-default" data-toggle="collapse" data-target="#panelBodymod{{$index}}">Cerrar</button>
                                                        <div class="btn btn-primary" data-loading-text="Guardando..." ng-click="INMEDIKApp.SaveCurrentNote(INMEDIKApp.selectedconcept, evolution, $index, INMEDIKApp.ConsultFile.id, false, INMEDIKApp.conceptselected)"  ng-disabled="evolution.id > 0 && !evolution.evolutionExplorationAux.saveVitalSigns">Guardar Nota</div>
                                                        <div class="btn btn-primary" data-loading-text="Guardando..." ng-if="evolution.objRecipe.recipe" ng-click="INMEDIKApp.SaveCurrentNote(INMEDIKApp.selectedconcept, evolution, $index, INMEDIKApp.ConsultFile.id, true, INMEDIKApp.conceptselected)"  ng-disabled="evolution.id > 0 && evolution.objRecipe.id && !evolution.evolutionExplorationAux.saveVitalSigns">Guardar e Imprimir</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @* fin nota evolucion *@
                            @* inicio panel nota interconsulta *@
                            <div id="Interconsulta-tab" class="tab-pane fade">
                                <div class="form-horizontal">
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <div class="col-md-12 pull-right">
                                                <label class="col-md-3 pull-right">
                                                    Nueva interconsulta 
                                                    <button id="addInterConsult" class="btn btn-info btn-xs col-md-3 pull-right" ng-click="INMEDIKApp.addInterConsult(false)" data-toggle="collapse" data-target="#panelBodyInter0">
                                                        <i class="fa fa-folder" aria-hidden="true"></i>
                                                    </button>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12" ng-repeat="interconsult in INMEDIKApp.ConsultFile.interconsultAux">
                                            <div class="panel panel-default">
                                                <div class="panel-heading" ng-if="!interconsult.IsCancelled">
                                                    @*<label class="col-lg-3">{{evolution.stringVersion}}</label>
                                                        <label class="col-lg-3">Creada por: {{evolution.stringCreatedBy}}</label>
                                                        <label class="col-lg-3">Creada el día: {{evolution.created_string}}</label>*@
                                                    <span class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#panelBodyInter{{$index}}"><i class="fas fa-bars"></i></span>
                                                    <span class="btn btn-warning btn-xs pull-left col-md-1" ng-click="INMEDIKApp.SaveCurrentInterconsult(interconsult,$index,INMEDIKApp.ConsultFile.id)" @*ng-disabled="INMEDIKApp.subbmiting||interconsult.IsCancelled"*@>Guardar  <i class="fa fa-folder"></i></span>
                                                    <span class="btn btn-danger btn-xs pull-right" ng-click="INMEDIKApp.InterConsultModal($index, interconsult)"><i class="fa fa-times"></i></span>
                                                    <label class="col-md-4">Creada el día: {{interconsult.sCreated}}</label>
                                                    <label class="col-md-4">Doctor: {{interconsult.CreatedBy}}</label>
                                                    <div class="clearfix"></div>
                                                </div>
                                                <div class="panel-heading" style="background-color: #ff1a1a" ng-if="interconsult.IsCancelled">
                                                    <span class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#panelBodyInter{{$index}}"><i class="fas fa-bars"></i></span>
                                                    <span class="btn btn-warning btn-xs pull-left col-md-1" ng-click="INMEDIKApp.SaveCurrentInterconsult(interconsult,$index,INMEDIKApp.ConsultFile.id)" @*ng-disabled="INMEDIKApp.subbmiting||interconsult.IsCancelled"*@>Guardar  <i class="fa fa-folder"></i></span>
                                                    <label class="col-md-4">Creada el día: {{interconsult.sCreated}}</label>
                                                    <label class="col-md-4">Doctor: {{interconsult.CreatedBy}}</label>
                                                    <label class="col-md-1 pull-right">Cancelado</label>
                                                    <div class="clearfix"></div>
                                                </div>
                                                <div class="panel-body collapse" id="panelBodyInter{{$index}}">
                                                    <div class="form-group col-md-12">
                                                        <label class="control-label col-md-2">Especialidad: </label>
                                                        <div class="col-md-10">
                                                            <select id="Speciality" name="Speciality" class="form-control" ng-model="interconsult.specialityAux" ng-options="ct.name for ct in INMEDIKApp.SpecialitiesL track by ct.id">
                                                                <option value="0">Seleccione...</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label class="control-label col-md-2">Motivo de envío: </label>
                                                        <div class="col-md-10">
                                                            <textarea id="shippingReason" name="shippingReason" maxlength="500" ng-model="interconsult.shippingReason" rows="2" placeholder="Motivo de envío" class="col-md-12"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label class="control-label col-md-2">Criterios diagnósticos: </label>
                                                        <div class="col-md-10">
                                                            <textarea id="diagnosticCriteria" name="diagnosticCriteria" maxlength="500" ng-model="interconsult.diagnosticCriteria" rows="2" placeholder="Criterios diagnósticos" class="col-md-12"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label class="control-label col-md-2"> Plan de estudios: </label>
                                                        <div class="col-md-10">
                                                            <textarea id="studyPlan" name="studyPlan" maxlength="500" ng-model="interconsult.studyPlan" rows="2" placeholder="Plan de estudios" class="col-md-12"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label class="control-label col-md-2">Sugerencias diagnósticas y tratamiento: </label>
                                                        <div class="col-md-10">
                                                            <textarea id="suggestions" name="suggestions" maxlength="500" ng-model="interconsult.suggestions" rows="2" placeholder="Sugerencias diagnósticas y tratamiento" class="col-md-12"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label class="control-label col-md-2">Contrareferencia: </label>
                                                        <div class="col-md-10">
                                                            <textarea id="counterReference" name="counterReference" maxlength="500" ng-model="interconsult.counterReference" rows="2" placeholder="Contrareferencia" class="col-md-12"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            @* fin panel nota interconsulta *@
                            @* inicio panel nota referencia *@
                            <div id="Referencia-tab" class="tab-pane fade">
                                <div class="form-horizontal">
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <div class="col-md-12 pull-right">
                                                <label class="col-md-3 pull-right">
                                                    Nueva nota de referencia 
                                                    <button id="addReferenceConsult" class="btn btn-info btn-xs col-md-3 pull-right" ng-click="INMEDIKApp.addReferenceConsult(false)" data-toggle="collapse" data-target="#panelBodyRef0">
                                                        <i class="fa fa-folder" aria-hidden="true"></i>
                                                    </button>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12" ng-repeat="reference in INMEDIKApp.ConsultFile.referencenoteAux">
                                            <div class="panel panel-default">
                                                <div class="panel-heading" ng-if="!reference.IsCancelled">
                                                    <span class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#panelBodyRef{{$index}}"><i class="fas fa-bars"></i></span>
                                                    <span class="btn btn-warning btn-xs pull-left col-md-1" ng-click="INMEDIKApp.SaveCurrentReferenceNote(reference,$index,INMEDIKApp.ConsultFile.id)" @*ng-disabled="INMEDIKApp.subbmiting||reference.IsCancelled"*@>Guardar  <i class="fa fa-folder"></i></span>
                                                    <span class="btn btn-danger btn-xs pull-right" ng-click="INMEDIKApp.ReferenceModal($index, reference)"><i class="fa fa-times"></i></span>
                                                    <label class="col-md-4">Creada el día: {{reference.sCreated}}</label>
                                                    <label class="col-md-4">Doctor: {{reference.CreatedBy}}</label>
                                                    <div class="clearfix"></div>
                                                </div>
                                                <div class="panel-heading" style="background-color: #ff1a1a" ng-if="reference.IsCancelled">
                                                    <span class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#panelBodyRef{{$index}}"><i class="fas fa-bars"></i></span>
                                                    <span class="btn btn-warning btn-xs pull-left col-md-1" ng-click="INMEDIKApp.SaveCurrentReferenceNote(reference,$index,INMEDIKApp.ConsultFile.id)" @*ng-disabled="INMEDIKApp.subbmiting||reference.IsCancelled"*@>Guardar  <i class="fa fa-folder"></i></span>
                                                    <label class="col-md-4">Creada el día: {{reference.sCreated}}</label>
                                                    <label class="col-md-4">Doctor: {{reference.CreatedBy}}</label>
                                                    <label class="col-md-1 pull-right">Cancelado</label>
                                                    <div class="clearfix"></div>
                                                </div>
                                                <div class="panel-body collapse" id="panelBodyRef{{$index}}">
                                                    <div class="form-group col-md-12">
                                                        <label class="control-label col-md-2">Establecimiento que envía: </label>
                                                        <div class="col-md-10">
                                                            <select id="Establecimiento" name="Establecimiento" class="form-control" ng-model="reference.clinicAux" ng-options="ct.name for ct in INMEDIKApp.ClinicsL track by ct.id">
                                                                <option value="">Seleccione...</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label class="control-label col-md-2"> Establecimiento receptor: </label>
                                                        <div class="col-md-10">
                                                            <textarea id="establishmentThatReceives" name="establishmentThatReceives" maxlength="500" ng-model="reference.establishmentThatReceives" rows="2" placeholder="Establecimiento receptor" class="col-md-12"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label class="control-label col-md-2">Criterios diagnósticos: </label>
                                                        <div class="col-md-10">
                                                            <textarea id="diagnosticCriteria" name="diagnosticCriteria" maxlength="500" ng-model="reference.diagnosticCriteria" rows="2" placeholder="Criterios diagnósticos" class="col-md-12"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label class="control-label col-md-2"> Plan de estudios: </label>
                                                        <div class="col-md-10">
                                                            <textarea id="studyPlan" name="studyPlan" maxlength="500" ng-model="reference.studyPlan" rows="2" placeholder="Plan de estudios" class="col-md-12"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label class="control-label col-md-2">Sugerencias diagnósticas y tratamiento: </label>
                                                        <div class="col-md-10">
                                                            <textarea id="suggestions" name="suggestions" maxlength="500" ng-model="reference.suggestions" rows="2" placeholder="Sugerencias diagnósticas y tratamiento" class="col-md-12"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label class="control-label col-md-2">Contrareferencia: </label>
                                                        <div class="col-md-10">
                                                            <textarea id="counterReference" name="counterReference" maxlength="500" ng-model="reference.counterReference" rows="2" placeholder="Contrareferencia" class="col-md-12"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-md-12">
                                                        <label class="control-label col-md-2">Motivo de envío: </label>
                                                        <div class="col-md-10">
                                                            <textarea id="shippingReason" name="shippingReason" maxlength="500" ng-model="reference.shippingReason" rows="2" placeholder="Motivo de envío" class="col-md-12"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @* fin panel nota referencia *@
                            @* inicio panel examenes *@
                            <div id="Examn-tab" class="tab-pane fade">
                                <div class="form-horizontal">
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <div class="col-md-2">
                                                <ul class="nav nav-pills col-md-12">
                                                    <li class="active">
                                                        <a id="Te-nav" href="#Ex-tab" data-toggle="tab" data-placement="right" data-container="body" title="Antecedentes Heredofamiliares">
                                                            Toma de examen
                                                        </a>
                                                    </li>
                                                    <li>
                                                        <a id="Res-nav" href="#Result-tab" data-toggle="tab" data-placement="right" data-container="body" title="Antecedentes Heredofamiliares">
                                                            Resultados previos de laboratorio
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="col-md-10">
                                                <div class="tab-content">
                                                    <div id="Ex-tab" class="tab-pane fade in active">
                                                        <div class="form-horizontal">
                                                            <div class="form-group">
                                                                <div class="col-md-12">
                                                                    <div class="col-md-12 pull-right">
                                                                        <label class="col-md-3 pull-right">
                                                                            Nuevo Examen 
                                                                            <button @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ id="addExam" class="btn btn-info btn-xs col-md-3 pull-right" ng-click="INMEDIKApp.addExam()" data-toggle="collapse" data-target="#panelBodyexm0">
                                                                                <i class="fa fa-folder" aria-hidden="true"></i>
                                                                            </button>
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <div class="col-md-12" ng-repeat="examn in INMEDIKApp.ConsultFile.examnoteAux">
                                                                    <div class="panel panel-default">
                                                                        <div class="panel-heading">
                                                                            <span class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#panelBodyexm{{$index}}"><i class="fas fa-bars"></i></span>
                                                                            <span class="btn btn-warning btn-xs pull-left col-md-1" ng-disabled="examn.recipeAux.id > 0" ng-click="INMEDIKApp.SaveExamnsElements(INMEDIKApp.selectedconcept, evolution,$index,INMEDIKApp.ConsultFile.id,false)">Guardar  <i class="fa fa-folder"></i></span>
                                                                            <span class="btn btn-danger btn-xs pull-right" ng-disabled="examn.recipeAux.id > 0" ng-click="INMEDIKApp.ExamModal($index)"><i class="fa fa-times"></i></span>
                                                                            <label class="col-md-2">Creada el día: {{examn.sCreated}}</label>
                                                                            <label class="col-md-2">Doctor: {{examn.createdby}}</label>
                                                                            <div class="clearfix"></div>
                                                                        </div>
                                                                        <div class="panel-body collapse" id="panelBodyexm{{$index}}">
                                                                            <div class="form-group ">
                                                                                <div class="col-md-8">
                                                                                    <div class="form-group">
                                                                                        <label class="control-label col-md-3" for="ConsultTipe">Tipo: </label>
                                                                                        <div class="col-md-9">
                                                                                            <input ng-click="type = 'Exámenes'" type="text" ng-disabled="examn.recipeAux.id > 0" placeholder="tipo de examen" id="name{{type}}" name="ConsultTipe"
                                                                                                   ng-model="examn.conceptAux.name"
                                                                                                   uib-typeahead="item.name for item in INMEDIKApp.loadConcepts($viewValue,type)"
                                                                                                   typeahead-loading="loading[type]"
                                                                                                   typeahead-editable="false"
                                                                                                   typeahead-no-results="noResult[type]" class="form-control"
                                                                                                   typeahead-on-select="INMEDIKApp.setConceptSelected($item,type)"
                                                                                                   autocomplete="off" />
                                                                                            <span class="text-danger" ng-show="noResult[type]">No se encontro coincidencias</span>
                                                                                            <span class="text-primary" ng-show="loading[type]">Buscando...</span>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group col-md-12">
                                                                                <div class="col-md-12">
                                                                                    <label class="col-md-2">Receta:</label>
                                                                                    <textarea class="col-md-10" placeholder="Receta" rows="10" maxlength="1000" ng-model="examn.recipeAux.recipe" ng-disabled="examn.recipeAux.id > 0"></textarea>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-12">
                                                                                <button id="printDisease" class="btn btn-info btn-xs col-md-2 pull-right" style="margin: 4px" ng-click="INMEDIKApp.ShowPdfPrenscription(examn,$index,INMEDIKApp.ConsultFile.id,true)">Imprimir</button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div id="Result-tab" class="tab-pane fade">
                                                        <div class="form-horizontal">
                                                            <div class="form-group">
                                                                <div class="col-md-12">
                                                                    <div class="col-md-12 pull-right">
                                                                        <label class="col-md-3 pull-right">
                                                                            Nuevo Resultado 
                                                                            <button @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ id="addPreviousResult" class="btn btn-info btn-xs col-md-3 pull-right" ng-click="INMEDIKApp.addPreviousResult()" data-toggle="collapse" data-target="#panelBodyResults0">
                                                                                <i class="fa fa-folder" aria-hidden="true"></i>
                                                                            </button>
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <div class="col-md-12" ng-repeat="results in INMEDIKApp.PreviousResult">
                                                                    <div class="panel panel-default">
                                                                        <div class="panel-heading">
                                                                            <span class="btn btn-info btn-xs pull-left" data-toggle="collapse" data-target="#panelBodyResults{{$index}}"><i class="fas fa-bars"></i></span>
                                                                            <span class="btn btn-warning btn-xs pull-left col-md-1" ng-click="INMEDIKApp.SavePreviousResult(INMEDIKApp.selectedconcept, evolution,$index,INMEDIKApp.ConsultFile.id,false)" @*ng-disabled="INMEDIKApp.subbmiting||evolution.IsCancelled"*@>Guardar  <i class="fa fa-folder"></i></span>
                                                                            <span class="btn btn-danger btn-xs pull-right" @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ ng-click="INMEDIKApp.DeletePreviousResult($index)"><i class="fa fa-times"></i></span>
                                                                            <label class="col-md-2">Creada el día: {{results.sCreated}}</label>
                                                                            <label class="col-md-2">Doctor: {{results.CreatedBy}}</label>
                                                                            <div class="clearfix"></div>
                                                                        </div>
                                                                        <div class="panel-body collapse" id="panelBodyResults{{$index}}">
                                                                            <div class="form-group col-md-12">
                                                                                <label class="control-label col-md-2">
                                                                                    Colesterol:
                                                                                    <span class="label label-danger" ng-if="results.cholesterol<125 && results.cholesterol>1"> Hipocolesterolemia</span>
                                                                                    <span class="label label-danger" ng-if="results.cholesterol>200"> Hipercolesterolemia</span>
                                                                                </label>
                                                                                <div class="col-md-4">
                                                                                    <input @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ type="number" min="1" ng-model="results.cholesterol" /><span> mg/dl</span>
                                                                                </div>
                                                                                <div class="col-md-6">
                                                                                    <label class="col-md-6">Fecha de toma: </label>
                                                                                    <div class="col-md-6">
                                                                                        <input @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ date-time view="date" format="DD/MM/YYYY" min-view="date" class="form-control col-md-5" ng-model="results.dateOfTaking_Cholesterol" id="dateOfTaking_Cholesterol" name="dateOfTaking_Cholesterol"
                                                                                               readonly style="background-color: #ffffff !important; cursor: pointer !important;" placeholder="Fecha de toma">
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group col-md-12">
                                                                                <label class="control-label col-md-2">
                                                                                    Triglicéridos:
                                                                                    <span class="label label-danger" ng-if="results.triglycerides>150"> Hipertrigliceridemia</span>
                                                                                </label>
                                                                                <div class="col-md-4">
                                                                                    <input @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ type="number" min="1" ng-model="results.triglycerides" /> <span> mg/dl</span>
                                                                                </div>
                                                                                <div class="col-md-6">
                                                                                    <label class="col-md-6">Fecha de toma: </label>
                                                                                    <div class="col-md-6">
                                                                                        <input @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ date-time view="date" format="DD/MM/YYYY" min-view="date" class="form-control col-md-5" ng-model="results.dateOfTaking_Triglycerides" id="dateOfTaking_Triglycerides" name="dateOfTaking_Triglycerides"
                                                                                               readonly style="background-color: #ffffff !important; cursor: pointer !important;" placeholder="Fecha de toma">
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group col-md-12">
                                                                                <label class="control-label col-md-2">
                                                                                    Glucosa:
                                                                                    <span class="label label-danger" ng-if="(results.glucose<70 && results.glucose>1)"> Hipoglucemia</span>
                                                                                    <span class="label label-danger" ng-if="results.glucose>100 && results.glucose_category=='AD'"> Hiperglucemia</span>
                                                                                    <span class="label label-danger" ng-if="results.glucose>100 && results.glucose_category=='AC'"> Hiperglucemia</span>
                                                                                    <span class="label label-danger" ng-if="results.glucose>100 && results.glucose_category=='ADC'"> Hiperglucemia</span>
                                                                                    <span class="label label-danger" ng-if="results.glucose>140 && results.glucose_category=='2DD'"> Hiperglucemia</span>
                                                                                    <span class="label label-danger" ng-if="results.glucose>140 && results.glucose_category=='2DC'"> Hiperglucemia</span>
                                                                                    <span class="label label-danger" ng-if="results.glucose>140 && results.glucose_category=='2ADC'"> Hiperglucemia</span>
                                                                                </label>
                                                                                <div class="col-md-4">
                                                                                    <input @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ type="number" min="1" ng-model="results.glucose" /><span> mg/dl</span>
                                                                                </div>
                                                                                <div class="col-md-6">
                                                                                    <label class="col-md-6">Fecha de toma: </label>
                                                                                    <div class="col-md-6">
                                                                                        <input @*ng-disabled="INMEDIKApp.ConsultFile.explorationAux.id != undefined"*@ date-time view="date" format="DD/MM/YYYY" min-view="date" class="form-control col-md-5" ng-model="results.dateOfTaking_Glucose" id="dateOfTaking_Glucose" name="dateOfTaking_Glucose"
                                                                                               readonly style="background-color: #ffffff !important; cursor: pointer !important;" placeholder="Fecha de toma">
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group col-md-12">
                                                                                <div class="col-md-4" style="margin-left: 120px">
                                                                                    <div class="col-md-4">
                                                                                        <label>Categoría: </label>
                                                                                    </div>
                                                                                    <div class="col-md-8">
                                                                                        <select name="time" id="time" class="form-control" ng-model="results.glucose_category">
                                                                                            <option value="">Seleccione...</option>
                                                                                            <option value="AD">Antes del desayuno</option>
                                                                                            <option value="2DD">2 horas despues del desayuno</option>
                                                                                            <option value="AC">Antes de la comida</option>
                                                                                            <option value="2DC">2 horas despues de la comida</option>
                                                                                            <option value="ADC">Antes de la cena</option>
                                                                                            <option value="2ADC">2 horas despues de la cena</option>
                                                                                        </select>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group col-md-12">
                                                                                <div class="form-group">
                                                                                    <label class="control-label col-md-2">Comentarios:</label>
                                                                                    <div class="col-md-8">
                                                                                        <textarea id="Comments" name="comments" maxlength="200" rows="3" placeholder="Comentarios" class="col-md-12" ng-model="results.comments"></textarea>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @* fin panel examenes *@
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade modal-info" id="CIE10Modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4>Agregar enfermedad</h4>
                </div>
                <div class="modal-body">
                    <div class="panel-body">
                        <div class="col-md-12">
                            <div class="table-responsive">
                                <table id="CIE10Table" datatable dt-options="INMEDIKApp.dtOptionsCIE10" dt-columns="INMEDIKApp.dtColumnsCIE10" dt-instance="INMEDIKApp.dtInstanceCallbackCIE10" class="table table-hover table-bordered"></table>
                            </div>
                        </div>
                    </div>
                </div>
                @*<div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    </div>*@
            </div>
        </div>
    </div>

    <div class="modal fade modal-info" id="PatientModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" style="width: 50%;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4>Seleccionar paciente</h4>
                </div>
                <div class="modal-body">
                    <div class="panel-body">
                        <div class="col-sm-12">
                            <div class="form-group">
                                <label for="namePatient" class="control-label col-sm-3 ">Nombre o Fólio: </label>
                                <div class="col-sm-9">
                                    <div class="input-group">
                                        <input class="form-control"
                                               type="text" placeholder="Escribir nombre o fólio de paciente"
                                               id="namePatient" name="namePatient"
                                               ng-model="INMEDIKApp.namePatient"
                                               uib-typeahead="item.personAux.fullName for item in INMEDIKApp.loadClients($viewValue)"
                                               typeahead-loading="loadingPatients"
                                               typeahead-editable="false"
                                               typeahead-no-results="noResultPatients"
                                               typeahead-on-select="INMEDIKApp.setPatientData($item)"
                                               autocomplete="off" />
                                        <span class="input-group-btn"><button class="btn btn-success" ng-click="INMEDIKApp.createPatient()">Nuevo</button></span>
                                    </div>
                                    <span class="text-danger" ng-show="noResultPatients">No se encontro coincidencias</span>
                                    <span class="text-primary" ng-show="loadingPatients">Buscando...</span>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                        <div class="col-sm-12">
                            <h4>Datos del paciente</h4>
                        </div>
                        <div class="col-sm-12">
                            <div class="form-group">
                                <div class="col-sm-6">
                                    <label class="control-label col-sm-4">Nombre del paciente: </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" readonly ng-model="INMEDIKApp.PatientData.personAux.fullName" />
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <label class="control-label col-sm-4">Dirección del paciente: </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" readonly ng-model="INMEDIKApp.PatientData.personAux.addressAux.fullAddress" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12">
                            <div class="form-group">
                                <div class="col-sm-6">
                                    <label class="control-label col-sm-4">Edad del paciente: </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" readonly ng-model="INMEDIKApp.PatientData.personAux.age" />
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <label class="control-label col-sm-4">Sexo del paciente: </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" readonly ng-model="INMEDIKApp.PatientData.personAux.sex" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" ng-disabled="INMEDIKApp.PatientData.id == undefined" ng-click="INMEDIKApp.SelectPatient(INMEDIKApp.PatientData)">Seleccionar</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="NewPatientModal" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
        <div class="modal-dialog modal-lg" style="width: 80%">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="newPatientModalLabel"><span>Agregar</span> Pacientes</h4>
                </div>
                <div class="alert alert-danger" ng-show="PatientForms.$invalid && INMEDIKApp.FormTouchedAndInvalid">
                    <div class="col-mb-12">
                        Revise los siguientes campos antes de continuar
                    </div>
                    <p ng-show="PatientForms.name.$touched && PatientForms.name.$error.required"><strong>Nombre(s)</strong>: Campo obligatorio</p>
                    <p ng-show="PatientForms.lastname.$touched && PatientForms.lastname.$error.required"><strong>Apellido Paterno</strong>: Campo obligatorio</p>
                    <p ng-show="PatientForms.secondlastname.$touched && PatientForms.secondlastname.$error.required"><strong>Apellido Materno</strong>: Campo obligatorio</p>
                    <p ng-show="PatientForms.sex.$touched && PatientForms.sex.$error.required"><strong>Sexo</strong>: Campo obligatorio</p>
                    <p ng-show="PatientForms.birthdate.$touched && PatientForms.birthdate.$error.required"><strong>Fecha de nacimiento</strong>: Campo obligatorio</p>
                    <p ng-show="PatientForms.birthdate.$touched && !PatientForms.birthdate.$error.required && !PatientForms.birthdate.$valid"><strong>Fecha de nacimiento</strong>: Formato incorrecto. Intente con formato dd/mm/aaaa</p>

                    <p ng-show="PatientForms.address.$touched && PatientForms.address.$error.required"><strong>Dirección</strong>: Campo obligatorio</p>
                    <p ng-show="PatientForms.postalCode.$touched && PatientForms.postalCode.$error.required"><strong>Código Postal</strong>: Campo obligatorio</p>
                    <p ng-show="PatientForms.postalCode.$touched && PatientForms.postalCode.$error.pattern"><strong>Código Postal</strong>: {{INMEDIKApp.regularExpretions.onlyNumbers.msg}} </p>
                    <p ng-show="PatientForms.stateAux.$touched && PatientForms.stateAux.$error.required"><strong>Estado</strong>: Campo obligatorio</p>
                    <p ng-show="PatientForms.cityAux.$touched && PatientForms.cityAux.$error.required"><strong>Municipio</strong>: Campo obligatorio</p>
                    <p ng-show="PatientForms.countyAux.$touched && PatientForms.countyAux.$error.required"><strong>Departamento</strong>: Campo obligatorio</p>
                    <p ng-show="PatientForms.email.$touched && PatientForms.email.$error.email"><strong>Correo</strong>: formato incorrecto</p>
                    <p ng-show="PatientForms.curp.$touched && PatientForms.curp.$error.pattern"><strong>Curp</strong>: {{INMEDIKApp.regularExpretions.CURP.msg}} </p>
                    <p ng-show="PatientForms.SocialSecurity.$touched && PatientForms.SocialSecurity.$error.pattern"><strong>Número de seguridad social</strong>: {{INMEDIKApp.regularExpretions.NSS.msg}}</p>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" name="PatientForms" id="PatientForms">
                        <div class="searchButton pull-right">
                            <span ng-if="INMEDIKApp.openSearchPatient" ng-click="INMEDIKApp.ToggleSearch()" class="btn btn-default">Regresar <i class="fa fa-arrow-circle-left"></i></span>
                            <span ng-click="INMEDIKApp.ToggleSearch()" class="btn btn-primary">Búsqueda <i class="fa fa-search"></i></span>
                        </div>
                        <div class="clearfix"></div>
                        <div ng-if="INMEDIKApp.openSearchPatient">
                            <div class="panel panel-default">
                                <div class="panel-heading">Personas</div>
                                <div class="panel-body">
                                    <div class="col-md-12">
                                        <div class="table-responsive">
                                            <table id="PersonTable" datatable dt-options="INMEDIKApp.dtPersonOptions" dt-columns="INMEDIKApp.dtPersonColumns" dt-instance="INMEDIKApp.PersonInstanceCallback" class="table-hover table-bordered compact"></table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div ng-if="!INMEDIKApp.openSearchPatient">
                            <div ng-init="currentForm = PatientForms">
                                @Html.Partial("~/Views/Shared/_PersonForm.cshtml")
                                <div class="clearfix"></div>
                            </div>
                            <div ng-init="currentForm = PatientForms">
                                @Html.Partial("~/Views/Shared/_AddressForm.cshtml")
                                <div class="clearfix"></div>
                            </div>
                            <div class="col-md-12 no-padding-sides">
                                <div class="col-md-6 no-padding-left">
                                    <div class="form-group" ng-class="{'invalid-group': (PatientForms.socialSecurity.$touched && PatientForms.socialSecurity.$invalid)}">
                                        <label for="SocialSecurity" class="control-label col-md-3">Número seguridad social: </label>
                                        <div class="col-md-9">
                                            <input type="text" class="form-control" ng-model="INMEDIKApp.person.socialSecurity"
                                                   ng-pattern="INMEDIKApp.regularExpretions.NSS.exp"
                                                   ng-text-change="INMEDIKApp.GetTouched($event)" ng-blur="INMEDIKApp.GetTouched($event)"
                                                   id="SocialSecurity" name="SocialSecurity" placeholder="NSS" maxlength="11">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 no-padding-right">
                                    <div class="form-group" ng-class="{'invalid-group': (PatientForms.reference.$touched && PatientForms.reference.$invalid)}">
                                        <label for="name" class="control-label col-md-3">Referencia: </label>
                                        <div class="col-md-9">
                                            <input type="text" class="form-control" ng-model="INMEDIKApp.Patient.reference" ng-text-change="INMEDIKApp.GetTouched($event)" ng-blur="INMEDIKApp.GetTouched($event)" id="ref" name="reference" placeholder="Referencia" maxlength="100">
                                        </div>
                                    </div>
                                </div>
                                @*<div class="col-md-6 no-padding-right">
                                    <div class="form-group" ng-class="{'invalid-group': (PatientForms.reference.$touched && PatientForms.reference.$invalid)}">
                                        <label for="name" class="control-label col-md-3">Empresa: </label>
                                        <div class="col-md-9">
                                            <select name="stateAux" id="stateAx" class="form-control" ng-text-change="INMEDIKApp.GetTouched($event)" ng-blur="INMEDIKApp.GetTouched($event)" ng-model="INMEDIKApp.person.companyName" required>
                                                <option value="">Seleccione...</option>
                                                <option value="PYOSA">Pyosa</option>
                                                <option value="REACTIMEX">Reactimex</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>*@
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" data-loading-text="Guardando..." ng-click="INMEDIKApp.SaveElementP()" @*ng-disabled="PatientForm.$invalid || INMEDIKApp.subbmiting"*@>Guardar</button>
                </div>
            </div>
        </div>
    </div>
    <div id="ImageDeleteModal" class="modal modal-danger fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Borrar archivo</h4>
                </div>
                <div class="modal-body">
                    Va a borrar la imagen y su descripción, ¿desea continuar?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" ng-click="INMEDIKApp.RemoveFile(INMEDIKApp.index, INMEDIKApp.evolution)" data-dismiss="modal">Continuar</button>
                </div>
            </div>

        </div>
    </div>
    <div id="EvDeletionWarningModal" class="modal modal-danger fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Borrar datos</h4>
                </div>
                <div class="modal-body">
                    Los datos no se han guardado, ¿desea borrarlos?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" ng-click="INMEDIKApp.DeleteEvolutionNote(INMEDIKApp.index)" data-dismiss="modal">Continuar</button>
                </div>
            </div>

        </div>
    </div>
    <div id="EvCancellationWarningModal" class="modal modal-danger fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Alerta de cancelación</h4>
                </div>
                <div class="modal-body">
                    Se va a cancelar la nota de Evolución guardada, ¿desea continuar?
                    <br>(No se puede revertir)
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" ng-click="INMEDIKApp.CancelEvolutionNote(INMEDIKApp.Evid)" data-dismiss="modal">Continuar</button>
                </div>
            </div>

        </div>
    </div>
    <div id="InDeletionWarningModal" class="modal modal-danger fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Borrar datos</h4>
                </div>
                <div class="modal-body">
                    Los datos no se han guardado, ¿desea borrarlos?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" ng-click="INMEDIKApp.DeleteInterConsult(INMEDIKApp.index)" data-dismiss="modal">Continuar</button>
                </div>
            </div>

        </div>
    </div>
    <div id="PdDeletionWarningModal" class="modal modal-danger fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Borrar datos</h4>
                </div>
                <div class="modal-body">
                    Los datos no se han guardado, ¿desea borrarlos?
                </div>
                <div class="modal-footer">
                    <button id="dltprodbtn" type="button" class="btn btn-danger" ng-click="INMEDIKApp.DeleteProductNote(INMEDIKApp.index)" data-dismiss="modal">Continuar</button>
                </div>
            </div>

        </div>
    </div>
    <div id="SvDeletionWarningModal" class="modal modal-danger fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Borrar datos</h4>
                </div>
                <div class="modal-body">
                    Los datos no se han guardado, ¿desea borrarlos?
                </div>
                <div class="modal-footer">
                    <button id="dltservbtn" type="button" class="btn btn-danger" ng-click="INMEDIKApp.DeleteServiceNote(INMEDIKApp.index)" data-dismiss="modal">Continuar</button>
                </div>
                <div class="modal-footer">
                    <button id="dltexmbtn" type="button" class="btn btn-danger" ng-click="INMEDIKApp.DeleteExamNote(INMEDIKApp.index)" data-dismiss="modal">Continuar</button>
                </div>
            </div>
        </div>
    </div>
    <div id="MeDeletionWarningModal" class="modal modal-danger fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Borrar datos</h4>
                </div>
                <div class="modal-body">
                    Los datos no se han guardado, ¿desea borrarlos?
                </div>
                <div class="modal-footer">
                    <button id="dltmedbtn" type="button" class="btn btn-danger" ng-click="INMEDIKApp.DeleteMedicamentNote(INMEDIKApp.index)" data-dismiss="modal">Continuar</button>
                </div>
            </div>

        </div>
    </div>
    <div id="InCancellationWarningModal" class="modal modal-danger fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Alerta de cancelación</h4>
                </div>
                <div class="modal-body">
                    Se va a cancelar la nota de Interconsulta guardada, ¿desea continuar?
                    <br>(No se puede revertir)
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" ng-click="INMEDIKApp.CancelInterconsultNote(INMEDIKApp.Inid)" data-dismiss="modal">Continuar</button>
                </div>
            </div>

        </div>
    </div>
    <div id="RefDeletionWarningModal" class="modal modal-danger fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Borrar datos</h4>
                </div>
                <div class="modal-body">
                    Los datos no se han guardado, ¿desea borrarlos?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" ng-click="INMEDIKApp.DeleteReferenceConsult(INMEDIKApp.index)" data-dismiss="modal">Continuar</button>
                </div>
            </div>

        </div>
    </div>
    <div id="RefCancellationWarningModal" class="modal modal-danger fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Alerta de cancelación</h4>
                </div>
                <div class="modal-body">
                    Se va a cancelar la nota de Referencia guardada, ¿desea continuar?
                    <br>(No se puede revertir)
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" ng-click="INMEDIKApp.CancelReferenceNote(INMEDIKApp.Refid)" data-dismiss="modal">Continuar</button>
                </div>
            </div>

        </div>
    </div>
    <div class="modal fade modal-info" id="RecipeModal" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4>Receta</h4>
                </div>
                <div class="modal-body">
                    @*<div class="form-group col-md-12">
                            <label class="col-md-2">Receta: </label>
                            <div class="col-md-10">
                                <div class="form-group" style="border:inset;max-width:700px;max-height:200px;min-height:200px;overflow:auto;">
                                    <div class="col-md-12" ng-repeat="recipe in evolution.recipeAux">
                                        <h5>{{recipe.nombre}}</h5>
                                        <ul ng-repeat="indications in recipe.indicationsAux">
                                            <li>{{indications.activeSubstance}}, {{indications.commercialBrand}}, {{indications.presentation}}</li>
                                            <li>{{indications.dose}} {{indications.unit}}, {{indications.frequency}}, {{indications.wayOfAdministration}}</li>
                                            <li>Por(Días): {{indications.daysOfThreatment}}</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <button id="printDisease" class="btn btn-info btn-xs col-md-2 pull-right" style="margin: 4px" ng-click="INMEDIKApp.ShowPdfPrenscription(evolution,$index,INMEDIKApp.ConsultFile.id,true)" ng-disabled="INMEDIKApp.subbmiting">Imprimir</button>
                                    <button id="addDisease" class="btn btn-default btn-xs col-md-2 pull-right" style="margin: 4px" ng-disabled="evolution.id > 0" ng-click="INMEDIKApp.cleanRecipe(evolution)">Limpiar</button>
                                </div>
                            </div>
                        </div>*@
                </div>
            </div>
        </div>
    </div>
</div>

